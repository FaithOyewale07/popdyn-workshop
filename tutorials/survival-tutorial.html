<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Estimation of demographic parameters - tutorial</title>
    <meta charset="utf-8" />
    <meta name="author" content="Olivier Gimenez for the team" />
    <script src="libs/header-attrs/header-attrs.js"></script>
    <link href="libs/remark-css/default.css" rel="stylesheet" />
    <link rel="stylesheet" href="slides-theme.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, title-slide

# Estimation of demographic parameters - tutorial
### Olivier Gimenez for the team
### last updated: 2022-02-08

---




class: center, middle
background-size: cover

## Live demo #1: A simple CJS model

---
## Load RMark package


```r
library(RMark)
```

```
This is RMark 2.2.7
 Documentation available at http://www.phidot.org/software/mark/rmark/RMarkDocumentation.zip
```

---
## Read in data (1)

Read in csv file:

```r
dipper_csv &lt;- read_csv("dat/dipper.csv")
```

```
Rows: 294 Columns: 9
```

```
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (1): sex
dbl (8): year_1981, year_1982, year_1983, year_1984, year_1985, year_1986, y...
```

```

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.
```

---
## Read in data (2)


```r
dipper_csv
```

```
# A tibble: 294 × 9
   year_1981 year_1982 year_1983 year_1984 year_1985 year_1986 year_1987 sex  
       &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;
 1         1         1         1         1         1         1         0 M    
 2         1         1         1         1         1         0         0 F    
 3         1         1         1         1         0         0         0 M    
 4         1         1         1         1         0         0         0 F    
 5         1         1         0         1         1         1         0 F    
 6         1         1         0         0         0         0         0 M    
 7         1         1         0         0         0         0         0 M    
 8         1         1         0         0         0         0         0 M    
 9         1         1         0         0         0         0         0 M    
10         1         1         0         0         0         0         0 F    
# … with 284 more rows, and 1 more variable: wing_length &lt;dbl&gt;
```

---
## Convert to Mark format (1)

Build a data.frame with encounter histories, sex and (scaled) wing length:

```r
dipper &lt;- data.frame(ch = unite(dipper_csv %&gt;% select(year_1981:year_1987), 
                                col = "ch", 
                                sep = ""), 
                     sex = dipper_csv$sex,
                     wglength = scale(dipper_csv$wing_length))
```

---
## Convert to Mark format (2)

Inspect first lines:

```r
head(dipper)
```

```
       ch sex   wglength
1 1111110   M  0.7581335
2 1111100   F -0.8671152
3 1111000   M  0.5259551
4 1111000   F -1.5636504
5 1101110   F -1.3314720
6 1100000   M  1.2224903
```

---
## Fit model with parameters constant over time


```r
phi.p &lt;- mark(dipper)
```

```

Output summary for CJS model
Name : Phi(~1)p(~1) 

Npar :  2
-2lnL:  666.8377
AICc :  670.866

Beta
                 estimate        se       lcl       ucl
Phi:(Intercept) 0.2421484 0.1020127 0.0422035 0.4420933
p:(Intercept)   2.2262660 0.3251093 1.5890516 2.8634803


Real Parameter Phi
 
         1        2        3        4        5        6
1 0.560243 0.560243 0.560243 0.560243 0.560243 0.560243
2          0.560243 0.560243 0.560243 0.560243 0.560243
3                   0.560243 0.560243 0.560243 0.560243
4                            0.560243 0.560243 0.560243
5                                     0.560243 0.560243
6                                              0.560243


Real Parameter p
 
          2         3         4         5         6         7
1 0.9025835 0.9025835 0.9025835 0.9025835 0.9025835 0.9025835
2           0.9025835 0.9025835 0.9025835 0.9025835 0.9025835
3                     0.9025835 0.9025835 0.9025835 0.9025835
4                               0.9025835 0.9025835 0.9025835
5                                         0.9025835 0.9025835
6                                                   0.9025835
```

---
## Explore results (1)

We get a list with many components:

```r
str(phi.p, max.level = 0)
```

```
List of 25
 - attr(*, "class")= chr [1:2] "mark" "CJS"
```

---
## Explore results (2)

What are the components of this list?

```r
names(phi.p)
```

```
 [1] "data"             "model"            "title"            "model.name"      
 [5] "links"            "mixtures"         "call"             "parameters"      
 [9] "time.intervals"   "number.of.groups" "group.labels"     "nocc"            
[13] "begin.time"       "covariates"       "fixed"            "design.matrix"   
[17] "pims"             "design.data"      "strata.labels"    "mlogit.list"     
[21] "profile.int"      "simplify"         "model.parameters" "results"         
[25] "output"          
```

---
## Explore results (3)

Get parameters estimates:

```r
phi.p$results$real
```

```
                 estimate        se       lcl       ucl fixed note
Phi g1 c1 a0 t1 0.5602430 0.0251330 0.5105493 0.6087577           
p g1 c1 a1 t2   0.9025835 0.0285857 0.8304826 0.9460113           
```

---
class: center, middle
background-size: cover

## Variation around the CJS model

---

Processed data.frame:

```r
dipper.proc &lt;- process.data(data = dipper, 
                            model = "CJS", 
                            groups = ("sex"))
```

```
Warning in process.data(data = dipper, model = "CJS", groups = ("sex")): 
  sex  is not a factor variable. Coercing to factor.
```

---

Design matrix:

```r
dipper.ddl &lt;- make.design.data(dipper.proc)
```

---


```r
phit &lt;- list(formula=~time)
phi &lt;- list(formula=~1)
pt &lt;- list(formula=~time)
p &lt;- list(formula=~1)
```

---


```r
phit.pt &lt;- mark(dipper.proc,
                dipper.ddl,
                model.parameters = list(Phi = phit, p = pt))
```

---


```

Output summary for CJS model
Name : Phi(~time)p(~time) 

Npar :  12  (unadjusted=11)
-2lnL:  656.9502
AICc :  681.7057  (unadjusted=679.58789)

Beta
                  estimate          se          lcl         ucl
Phi:(Intercept)  0.9354631   0.7685302   -0.5708562   2.4417824
Phi:time2       -1.1982825   0.8706784   -2.9048121   0.5082472
Phi:time3       -1.0228369   0.8049222   -2.6004844   0.5548106
Phi:time4       -0.4198662   0.8091563   -2.0058125   1.1660801
Phi:time5       -0.5361053   0.8031511   -2.1102814   1.0380709
Phi:time6        0.2481368 346.0466200 -678.0032500 678.4995200
p:(Intercept)    0.8292800   0.7837392   -0.7068488   2.3654089
p:time3          1.6556246   1.2913806   -0.8754815   4.1867307
p:time4          1.5220943   1.0729186   -0.5808261   3.6250148
p:time5          1.3767444   0.9884846   -0.5606855   3.3141742
p:time6          1.7950932   1.0688802   -0.2999120   3.8900984
p:time7         -0.0147589 264.2816100 -518.0067200 517.9772100


Real Parameter Phi
Group:sexF 
          1         2         3         4         5         6
1 0.7181823 0.4346708 0.4781704 0.6261176 0.5985334 0.7655944
2           0.4346708 0.4781704 0.6261176 0.5985334 0.7655944
3                     0.4781704 0.6261176 0.5985334 0.7655944
4                               0.6261176 0.5985334 0.7655944
5                                         0.5985334 0.7655944
6                                                   0.7655944

Group:sexM 
          1         2         3         4         5         6
1 0.7181823 0.4346708 0.4781704 0.6261176 0.5985334 0.7655944
2           0.4346708 0.4781704 0.6261176 0.5985334 0.7655944
3                     0.4781704 0.6261176 0.5985334 0.7655944
4                               0.6261176 0.5985334 0.7655944
5                                         0.5985334 0.7655944
6                                                   0.7655944


Real Parameter p
Group:sexF 
          2         3         4         5         6         7
1 0.6962027 0.9230768 0.9130434 0.9007892 0.9324138 0.6930721
2           0.9230768 0.9130434 0.9007892 0.9324138 0.6930721
3                     0.9130434 0.9007892 0.9324138 0.6930721
4                               0.9007892 0.9324138 0.6930721
5                                         0.9324138 0.6930721
6                                                   0.6930721

Group:sexM 
          2         3         4         5         6         7
1 0.6962027 0.9230768 0.9130434 0.9007892 0.9324138 0.6930721
2           0.9230768 0.9130434 0.9007892 0.9324138 0.6930721
3                     0.9130434 0.9007892 0.9324138 0.6930721
4                               0.9007892 0.9324138 0.6930721
5                                         0.9324138 0.6930721
6                                                   0.6930721
```

---


```r
phit.pt$results$real
```

```
                 estimate         se           lcl       ucl fixed note
Phi gF c1 a0 t1 0.7181823  0.1555478  3.610393e-01 0.9199584           
Phi gF c1 a1 t2 0.4346708  0.0688291  3.075046e-01 0.5710589           
Phi gF c1 a2 t3 0.4781704  0.0597091  3.643838e-01 0.5942685           
Phi gF c1 a3 t4 0.6261176  0.0592656  5.048460e-01 0.7333741           
Phi gF c1 a4 t5 0.5985334  0.0560517  4.855433e-01 0.7019411           
Phi gF c1 a5 t6 0.7655944 62.1011750 8.999006e-295 1.0000000           
p gF c1 a1 t2   0.6962027  0.1657644  3.302955e-01 0.9141512           
p gF c1 a2 t3   0.9230768  0.0728779  6.161495e-01 0.9889758           
p gF c1 a3 t4   0.9130434  0.0581758  7.140646e-01 0.9778505           
p gF c1 a4 t5   0.9007892  0.0538329  7.360176e-01 0.9672856           
p gF c1 a5 t6   0.9324138  0.0458025  7.684926e-01 0.9828579           
p gF c1 a6 t7   0.6930721 56.2185320 2.476525e-225 1.0000000           
```

---


```r
phit.p &lt;- mark(dipper.proc,
                dipper.ddl,
                model.parameters = list(Phi = phit, p = p))
```

---


```

Output summary for CJS model
Name : Phi(~time)p(~1) 

Npar :  7
-2lnL:  659.7301
AICc :  673.998

Beta
                  estimate        se        lcl       ucl
Phi:(Intercept)  0.5143923 0.4767779 -0.4200924 1.4488769
Phi:time2       -0.6981425 0.5537174 -1.7834287 0.3871437
Phi:time3       -0.6009375 0.5300974 -1.6399285 0.4380535
Phi:time4       -0.0061073 0.5334586 -1.0516861 1.0394715
Phi:time5       -0.0757129 0.5276478 -1.1099027 0.9584768
Phi:time6       -0.1780648 0.5265627 -1.2101277 0.8539980
p:(Intercept)    2.2203955 0.3288850  1.5757809 2.8650100


Real Parameter Phi
Group:sexF 
          1         2         3         4         5         6
1 0.6258356 0.4541913 0.4783772 0.6244044 0.6079443 0.5832981
2           0.4541913 0.4783772 0.6244044 0.6079443 0.5832981
3                     0.4783772 0.6244044 0.6079443 0.5832981
4                               0.6244044 0.6079443 0.5832981
5                                         0.6079443 0.5832981
6                                                   0.5832981

Group:sexM 
          1         2         3         4         5         6
1 0.6258356 0.4541913 0.4783772 0.6244044 0.6079443 0.5832981
2           0.4541913 0.4783772 0.6244044 0.6079443 0.5832981
3                     0.4783772 0.6244044 0.6079443 0.5832981
4                               0.6244044 0.6079443 0.5832981
5                                         0.6079443 0.5832981
6                                                   0.5832981


Real Parameter p
Group:sexF 
          2         3         4         5         6         7
1 0.9020661 0.9020661 0.9020661 0.9020661 0.9020661 0.9020661
2           0.9020661 0.9020661 0.9020661 0.9020661 0.9020661
3                     0.9020661 0.9020661 0.9020661 0.9020661
4                               0.9020661 0.9020661 0.9020661
5                                         0.9020661 0.9020661
6                                                   0.9020661

Group:sexM 
          2         3         4         5         6         7
1 0.9020661 0.9020661 0.9020661 0.9020661 0.9020661 0.9020661
2           0.9020661 0.9020661 0.9020661 0.9020661 0.9020661
3                     0.9020661 0.9020661 0.9020661 0.9020661
4                               0.9020661 0.9020661 0.9020661
5                                         0.9020661 0.9020661
6                                                   0.9020661
```

---


```r
phi.pt &lt;- mark(dipper.proc,
                dipper.ddl,
                model.parameters = list(Phi = phi, p = pt))
```

---


```

Output summary for CJS model
Name : Phi(~1)p(~time) 

Npar :  7
-2lnL:  664.4802
AICc :  678.7481

Beta
                 estimate        se        lcl       ucl
Phi:(Intercept) 0.2131641 0.1121135 -0.0065784 0.4329066
p:(Intercept)   1.2955252 0.7437247 -0.1621752 2.7532255
p:time3         0.8005291 1.1635489 -1.4800269 3.0810850
p:time4         0.6512769 1.0018581 -1.3123650 2.6149189
p:time5         0.9977291 0.9454498 -0.8553526 2.8508108
p:time6         1.4658871 1.0304014 -0.5536997 3.4854740
p:time7         1.9900730 3.0642119 -4.0157825 7.9959285


Real Parameter Phi
Group:sexF 
          1         2         3         4         5         6
1 0.5530901 0.5530901 0.5530901 0.5530901 0.5530901 0.5530901
2           0.5530901 0.5530901 0.5530901 0.5530901 0.5530901
3                     0.5530901 0.5530901 0.5530901 0.5530901
4                               0.5530901 0.5530901 0.5530901
5                                         0.5530901 0.5530901
6                                                   0.5530901

Group:sexM 
          1         2         3         4         5         6
1 0.5530901 0.5530901 0.5530901 0.5530901 0.5530901 0.5530901
2           0.5530901 0.5530901 0.5530901 0.5530901 0.5530901
3                     0.5530901 0.5530901 0.5530901 0.5530901
4                               0.5530901 0.5530901 0.5530901
5                                         0.5530901 0.5530901
6                                                   0.5530901


Real Parameter p
Group:sexF 
          2         3         4         5         6         7
1 0.7850809 0.8905191 0.8750975 0.9083168 0.9405546 0.9639314
2           0.8905191 0.8750975 0.9083168 0.9405546 0.9639314
3                     0.8750975 0.9083168 0.9405546 0.9639314
4                               0.9083168 0.9405546 0.9639314
5                                         0.9405546 0.9639314
6                                                   0.9639314

Group:sexM 
          2         3         4         5         6         7
1 0.7850809 0.8905191 0.8750975 0.9083168 0.9405546 0.9639314
2           0.8905191 0.8750975 0.9083168 0.9405546 0.9639314
3                     0.8750975 0.9083168 0.9405546 0.9639314
4                               0.9083168 0.9405546 0.9639314
5                                         0.9405546 0.9639314
6                                                   0.9639314
```

---


```r
collect.models()
```

```
               model npar     AICc DeltaAICc      weight Deviance
1       Phi(~1)p(~1)    2 670.8660  0.000000 0.811204642 58.15788
3    Phi(~time)p(~1)    7 673.9980  3.132004 0.169443317 77.25297
2    Phi(~1)p(~time)    7 678.7481  7.882084 0.015760053 82.00306
4 Phi(~time)p(~time)   12 681.7057 10.839629 0.003591988 74.47310
```

---
class: center, middle
background-size: cover

## Live demo #2: Group effect

---


```r
phisex &lt;- list(formula=~sex)
```

---


```r
phisex.p &lt;- mark(dipper.proc,
                dipper.ddl,
                model.parameters = list(Phi = phisex, p = p))
```

```

Output summary for CJS model
Name : Phi(~sex)p(~1) 

Npar :  3
-2lnL:  666.6762
AICc :  672.7331

Beta
                 estimate        se        lcl       ucl
Phi:(Intercept) 0.2036416 0.1397215 -0.0702125 0.4774957
Phi:sexM        0.0792854 0.1973411 -0.3075032 0.4660740
p:(Intercept)   2.2274856 0.3251811  1.5901306 2.8648406


Real Parameter Phi
Group:sexF 
          1         2         3         4         5         6
1 0.5507352 0.5507352 0.5507352 0.5507352 0.5507352 0.5507352
2           0.5507352 0.5507352 0.5507352 0.5507352 0.5507352
3                     0.5507352 0.5507352 0.5507352 0.5507352
4                               0.5507352 0.5507352 0.5507352
5                                         0.5507352 0.5507352
6                                                   0.5507352

Group:sexM 
          1         2         3         4         5         6
1 0.5702637 0.5702637 0.5702637 0.5702637 0.5702637 0.5702637
2           0.5702637 0.5702637 0.5702637 0.5702637 0.5702637
3                     0.5702637 0.5702637 0.5702637 0.5702637
4                               0.5702637 0.5702637 0.5702637
5                                         0.5702637 0.5702637
6                                                   0.5702637


Real Parameter p
Group:sexF 
          2         3         4         5         6         7
1 0.9026907 0.9026907 0.9026907 0.9026907 0.9026907 0.9026907
2           0.9026907 0.9026907 0.9026907 0.9026907 0.9026907
3                     0.9026907 0.9026907 0.9026907 0.9026907
4                               0.9026907 0.9026907 0.9026907
5                                         0.9026907 0.9026907
6                                                   0.9026907

Group:sexM 
          2         3         4         5         6         7
1 0.9026907 0.9026907 0.9026907 0.9026907 0.9026907 0.9026907
2           0.9026907 0.9026907 0.9026907 0.9026907 0.9026907
3                     0.9026907 0.9026907 0.9026907 0.9026907
4                               0.9026907 0.9026907 0.9026907
5                                         0.9026907 0.9026907
6                                                   0.9026907
```

---


```r
phisex.p$results$beta
```

```
                 estimate        se        lcl       ucl
Phi:(Intercept) 0.2036416 0.1397215 -0.0702125 0.4774957
Phi:sexM        0.0792854 0.1973411 -0.3075032 0.4660740
p:(Intercept)   2.2274856 0.3251811  1.5901306 2.8648406
```

---


```r
logitphiF &lt;- phisex.p$results$beta[1,1]
plogis(logitphiF)
```

```
[1] 0.5507352
```

---


```r
logitphiM &lt;- logitphiF + phisex.p$results$beta[2,1]
plogis(logitphiM)
```

```
[1] 0.5702637
```

---


```r
phisex.p$results$real
```

```
                 estimate        se       lcl       ucl fixed note
Phi gF c1 a0 t1 0.5507352 0.0345707 0.4824541 0.6171564           
Phi gM c1 a0 t1 0.5702637 0.0353294 0.5000911 0.6377218           
p gF c1 a1 t2   0.9026907 0.0285640 0.8306345 0.9460808           
```


---


```r
collect.models()
```

```
               model npar     AICc DeltaAICc      weight Deviance
1       Phi(~1)p(~1)    2 670.8660  0.000000 0.615043503 58.15788
3     Phi(~sex)p(~1)    3 672.7331  1.867043 0.241814615 84.19909
4    Phi(~time)p(~1)    7 673.9980  3.132004 0.128469447 77.25297
2    Phi(~1)p(~time)    7 678.7481  7.882084 0.011949042 82.00306
5 Phi(~time)p(~time)   12 681.7057 10.839629 0.002723393 74.47310
```

---


```r
phisexpt &lt;- list(formula=~sex+time)
```

---


```r
phisexpt.p &lt;- mark(dipper.proc,
                dipper.ddl,
                model.parameters = list(Phi = phisexpt, p = p))
```

---


```

Output summary for CJS model
Name : Phi(~sex + time)p(~1) 

Npar :  8
-2lnL:  659.6491
AICc :  675.9945

Beta
                  estimate        se        lcl       ucl
Phi:(Intercept)  0.4829425 0.4891862 -0.4758625 1.4417474
Phi:sexM         0.0568890 0.1999509 -0.3350147 0.4487928
Phi:time2       -0.6915570 0.5541036 -1.7776002 0.3944862
Phi:time3       -0.5961728 0.5302495 -1.6354618 0.4431161
Phi:time4       -0.0022599 0.5335370 -1.0479924 1.0434726
Phi:time5       -0.0729161 0.5276467 -1.1071037 0.9612715
Phi:time6       -0.1754305 0.5265120 -1.2073941 0.8565330
p:(Intercept)    2.2215639 0.3289059  1.5769083 2.8662196


Real Parameter Phi
Group:sexF 
          1         2         3        4         5         6
1 0.6184425 0.4480347 0.4717226 0.617909 0.6010942 0.5762778
2           0.4480347 0.4717226 0.617909 0.6010942 0.5762778
3                     0.4717226 0.617909 0.6010942 0.5762778
4                               0.617909 0.6010942 0.5762778
5                                        0.6010942 0.5762778
6                                                  0.5762778

Group:sexM 
          1         2         3         4         5         6
1 0.6317732 0.4621412 0.4859184 0.6312473 0.6146534 0.5901054
2           0.4621412 0.4859184 0.6312473 0.6146534 0.5901054
3                     0.4859184 0.6312473 0.6146534 0.5901054
4                               0.6312473 0.6146534 0.5901054
5                                         0.6146534 0.5901054
6                                                   0.5901054


Real Parameter p
Group:sexF 
          2         3         4         5         6         7
1 0.9021693 0.9021693 0.9021693 0.9021693 0.9021693 0.9021693
2           0.9021693 0.9021693 0.9021693 0.9021693 0.9021693
3                     0.9021693 0.9021693 0.9021693 0.9021693
4                               0.9021693 0.9021693 0.9021693
5                                         0.9021693 0.9021693
6                                                   0.9021693

Group:sexM 
          2         3         4         5         6         7
1 0.9021693 0.9021693 0.9021693 0.9021693 0.9021693 0.9021693
2           0.9021693 0.9021693 0.9021693 0.9021693 0.9021693
3                     0.9021693 0.9021693 0.9021693 0.9021693
4                               0.9021693 0.9021693 0.9021693
5                                         0.9021693 0.9021693
6                                                   0.9021693
```


---


```r
collect.models()
```

```
                  model npar     AICc DeltaAICc      weight Deviance
1          Phi(~1)p(~1)    2 670.8660  0.000000 0.587240217 58.15788
3        Phi(~sex)p(~1)    3 672.7331  1.867043 0.230883290 84.19909
5       Phi(~time)p(~1)    7 673.9980  3.132004 0.122661934 77.25297
4 Phi(~sex + time)p(~1)    8 675.9945  5.128435 0.045205397 77.17203
2       Phi(~1)p(~time)    7 678.7481  7.882084 0.011408881 82.00306
6    Phi(~time)p(~time)   12 681.7057 10.839629 0.002600281 74.47310
```


---
class: center, middle
background-size: cover

## Live demo #2: Continuous individual covariate


---


```r
phiwl &lt;- list(formula=~wglength)
```

---


```r
phiwl.p &lt;- mark(dipper.proc,
                dipper.ddl,
                model.parameters = list(Phi = phiwl, p = p))
```

---


```

Output summary for CJS model
Name : Phi(~wglength)p(~1) 

Npar :  3
-2lnL:  666.8
AICc :  672.8569

Beta
                  estimate        se        lcl       ucl
Phi:(Intercept)  0.2418000 0.1020371  0.0418072 0.4417928
Phi:wglength    -0.0182028 0.0938329 -0.2021153 0.1657097
p:(Intercept)    2.2259841 0.3250863  1.5888150 2.8631532


Real Parameter Phi
Group:sexF 
          1         2         3         4         5         6
1 0.5601572 0.5601572 0.5601572 0.5601572 0.5601572 0.5601572
2           0.5601572 0.5601572 0.5601572 0.5601572 0.5601572
3                     0.5601572 0.5601572 0.5601572 0.5601572
4                               0.5601572 0.5601572 0.5601572
5                                         0.5601572 0.5601572
6                                                   0.5601572

Group:sexM 
          1         2         3         4         5         6
1 0.5601572 0.5601572 0.5601572 0.5601572 0.5601572 0.5601572
2           0.5601572 0.5601572 0.5601572 0.5601572 0.5601572
3                     0.5601572 0.5601572 0.5601572 0.5601572
4                               0.5601572 0.5601572 0.5601572
5                                         0.5601572 0.5601572
6                                                   0.5601572


Real Parameter p
Group:sexF 
          2         3         4         5         6         7
1 0.9025587 0.9025587 0.9025587 0.9025587 0.9025587 0.9025587
2           0.9025587 0.9025587 0.9025587 0.9025587 0.9025587
3                     0.9025587 0.9025587 0.9025587 0.9025587
4                               0.9025587 0.9025587 0.9025587
5                                         0.9025587 0.9025587
6                                                   0.9025587

Group:sexM 
          2         3         4         5         6         7
1 0.9025587 0.9025587 0.9025587 0.9025587 0.9025587 0.9025587
2           0.9025587 0.9025587 0.9025587 0.9025587 0.9025587
3                     0.9025587 0.9025587 0.9025587 0.9025587
4                               0.9025587 0.9025587 0.9025587
5                                         0.9025587 0.9025587
6                                                   0.9025587
```

---


```
                  estimate        se        lcl       ucl
Phi:(Intercept)  0.2418000 0.1020371  0.0418072 0.4417928
Phi:wglength    -0.0182028 0.0938329 -0.2021153 0.1657097
p:(Intercept)    2.2259841 0.3250863  1.5888150 2.8631532
```

---


```r
scaled_wl &lt;- scale(dipper_csv$wing_length)
grid_wl &lt;- seq(min(scaled_wl), max(scaled_wl), length = 100)
logit_predicted_survival &lt;- phiwl.p$results$beta[1,1] + phiwl.p$results$beta[2,1] * grid_wl
predicted_survival &lt;- plogis(logit_predicted_survival)
df &lt;- data.frame(winglength = grid_wl,
                 survival = predicted_survival)
df %&gt;% 
  ggplot() +
  aes(x = winglength, y = survival) + 
  geom_line()
```

---

&lt;img src="survival-tutorial_files/figure-html/unnamed-chunk-37-1.svg" style="display: block; margin: auto;" /&gt;

---


```r
dipper$wglengthsq &lt;- scale(dipper_csv$wing_length)^2
dipper.proc &lt;- process.data(data = dipper, 
                            model = "CJS", 
                            groups = ("sex"))
```

```
Warning in process.data(data = dipper, model = "CJS", groups = ("sex")): 
  sex  is not a factor variable. Coercing to factor.
```

```r
dipper.ddl &lt;- make.design.data(dipper.proc)
```


---


```r
phiwl2 &lt;- list(formula=~wglength + wglengthsq)
```

---


```r
phiwl2.p &lt;- mark(dipper.proc,
                 dipper.ddl,
                 model.parameters = list(Phi = phiwl2, p = p))
```

---


```

Output summary for CJS model
Name : Phi(~wglength + wglengthsq)p(~1) 

Npar :  4
-2lnL:  663.6145
AICc :  671.7095

Beta
                  estimate        se        lcl       ucl
Phi:(Intercept)  0.0165959 0.1618091 -0.3005499 0.3337418
Phi:wglength    -0.0255471 0.0955639 -0.2128523 0.1617582
Phi:wglengthsq   0.2058718 0.1165635 -0.0225927 0.4343362
p:(Intercept)    2.2313328 0.3250768  1.5941822 2.8684834


Real Parameter Phi
Group:sexF 
          1         2         3         4         5         6
1 0.5552158 0.5552158 0.5552158 0.5552158 0.5552158 0.5552158
2           0.5552158 0.5552158 0.5552158 0.5552158 0.5552158
3                     0.5552158 0.5552158 0.5552158 0.5552158
4                               0.5552158 0.5552158 0.5552158
5                                         0.5552158 0.5552158
6                                                   0.5552158

Group:sexM 
          1         2         3         4         5         6
1 0.5552158 0.5552158 0.5552158 0.5552158 0.5552158 0.5552158
2           0.5552158 0.5552158 0.5552158 0.5552158 0.5552158
3                     0.5552158 0.5552158 0.5552158 0.5552158
4                               0.5552158 0.5552158 0.5552158
5                                         0.5552158 0.5552158
6                                                   0.5552158


Real Parameter p
Group:sexF 
          2         3         4         5         6         7
1 0.9030281 0.9030281 0.9030281 0.9030281 0.9030281 0.9030281
2           0.9030281 0.9030281 0.9030281 0.9030281 0.9030281
3                     0.9030281 0.9030281 0.9030281 0.9030281
4                               0.9030281 0.9030281 0.9030281
5                                         0.9030281 0.9030281
6                                                   0.9030281

Group:sexM 
          2         3         4         5         6         7
1 0.9030281 0.9030281 0.9030281 0.9030281 0.9030281 0.9030281
2           0.9030281 0.9030281 0.9030281 0.9030281 0.9030281
3                     0.9030281 0.9030281 0.9030281 0.9030281
4                               0.9030281 0.9030281 0.9030281
5                                         0.9030281 0.9030281
6                                                   0.9030281
```

---


```
                  estimate        se        lcl       ucl
Phi:(Intercept)  0.0165959 0.1618091 -0.3005499 0.3337418
Phi:wglength    -0.0255471 0.0955639 -0.2128523 0.1617582
Phi:wglengthsq   0.2058718 0.1165635 -0.0225927 0.4343362
p:(Intercept)    2.2313328 0.3250768  1.5941822 2.8684834
```

---


```r
scaled_wl &lt;- scale(dipper_csv$wing_length)
grid_wl &lt;- seq(min(scaled_wl), max(scaled_wl), length = 100)
logit_predicted_survival &lt;- phiwl2.p$results$beta[1,1] + phiwl2.p$results$beta[2,1] * grid_wl + phiwl2.p$results$beta[2,1] * grid_wl^2
predicted_survival &lt;- plogis(logit_predicted_survival)
df &lt;- data.frame(winglength = grid_wl,
                 survival = predicted_survival)
df %&gt;% 
  ggplot() +
  aes(x = winglength, y = survival) + 
  geom_line()
```

---

&lt;img src="survival-tutorial_files/figure-html/unnamed-chunk-44-1.svg" style="display: block; margin: auto;" /&gt;

---


```r
collect.models()
```

```
                             model npar     AICc  DeltaAICc      weight
1                     Phi(~1)p(~1)    2 670.8660  0.0000000 0.366521074
8 Phi(~wglength + wglengthsq)p(~1)    4 671.7095  0.8434531 0.240406077
3                   Phi(~sex)p(~1)    3 672.7331  1.8670432 0.144103876
7              Phi(~wglength)p(~1)    3 672.8569  1.9908732 0.135452280
5                  Phi(~time)p(~1)    7 673.9980  3.1320038 0.076558421
4            Phi(~sex + time)p(~1)    8 675.9945  5.1284349 0.028214571
2                  Phi(~1)p(~time)    7 678.7481  7.8820838 0.007120758
6               Phi(~time)p(~time)   12 681.7057 10.8396291 0.001622943
   Deviance
1  58.15788
8 663.61447
3  84.19909
7 666.80003
5  77.25297
4  77.17203
2  82.00306
6  74.47310
```

---
class: center, middle
background-size: cover

## Live demo #3: Environmental covariate

---


```r
head(dipper.ddl$Phi)
```

```
  par.index model.index group cohort age time occ.cohort Cohort Age Time sex
1         1           1     F      1   0    1          1      0   0    0   F
2         2           2     F      1   1    2          1      0   1    1   F
3         3           3     F      1   2    3          1      0   2    2   F
4         4           4     F      1   3    4          1      0   3    3   F
5         5           5     F      1   4    5          1      0   4    4   F
6         6           6     F      1   5    6          1      0   5    5   F
```

---


```r
dipper.ddl$Phi$Flood &lt;- 0
head(dipper.ddl$Phi)
```

```
  par.index model.index group cohort age time occ.cohort Cohort Age Time sex
1         1           1     F      1   0    1          1      0   0    0   F
2         2           2     F      1   1    2          1      0   1    1   F
3         3           3     F      1   2    3          1      0   2    2   F
4         4           4     F      1   3    4          1      0   3    3   F
5         5           5     F      1   4    5          1      0   4    4   F
6         6           6     F      1   5    6          1      0   5    5   F
  Flood
1     0
2     0
3     0
4     0
5     0
6     0
```

---


```r
dipper.ddl$Phi$Flood[dipper.ddl$Phi$time==2 | dipper.ddl$Phi$time==3] &lt;- 1
head(dipper.ddl$Phi)
```

```
  par.index model.index group cohort age time occ.cohort Cohort Age Time sex
1         1           1     F      1   0    1          1      0   0    0   F
2         2           2     F      1   1    2          1      0   1    1   F
3         3           3     F      1   2    3          1      0   2    2   F
4         4           4     F      1   3    4          1      0   3    3   F
5         5           5     F      1   4    5          1      0   4    4   F
6         6           6     F      1   5    6          1      0   5    5   F
  Flood
1     0
2     1
3     1
4     0
5     0
6     0
```

---


```r
phiFlood &lt;- list(formula=~Flood)
```

---


```r
phiFlood.p &lt;- mark(dipper.proc,
                   dipper.ddl,
                   model.parameters = list(Phi = phiFlood, p = p))
```

---


```r
collect.models()
```

```
                             model npar     AICc  DeltaAICc      weight
1                     Phi(~1)p(~1)    2 670.8660  0.0000000 0.366521074
8 Phi(~wglength + wglengthsq)p(~1)    4 671.7095  0.8434531 0.240406077
3                   Phi(~sex)p(~1)    3 672.7331  1.8670432 0.144103876
7              Phi(~wglength)p(~1)    3 672.8569  1.9908732 0.135452280
5                  Phi(~time)p(~1)    7 673.9980  3.1320038 0.076558421
4            Phi(~sex + time)p(~1)    8 675.9945  5.1284349 0.028214571
2                  Phi(~1)p(~time)    7 678.7481  7.8820838 0.007120758
6               Phi(~time)p(~time)   12 681.7057 10.8396291 0.001622943
   Deviance
1  58.15788
8 663.61447
3  84.19909
7 666.80003
5  77.25297
4  77.17203
2  82.00306
6  74.47310
```


---
class: center, middle
background-size: cover

## Live demo #4: Age in capture-recapture models

---


```r
phi.age &lt;- list(formula =~ age)
```

---


```r
phiage.p &lt;- mark(dipper.proc,
                      dipper.ddl,
                      model.parameters = list(Phi = phi.age, 
                                              p = p))
```

```
Warning in type.convert.default(substr(out[x], regexpr("=", out[x]) + 1, :
'as.is' should be specified by the caller; using TRUE
```

```
Warning in type.convert.default(substr(out[x], locate(x) + 4, nchar(out[x]))):
'as.is' should be specified by the caller; using TRUE

Warning in type.convert.default(substr(out[x], locate(x) + 4, nchar(out[x]))):
'as.is' should be specified by the caller; using TRUE

Warning in type.convert.default(substr(out[x], locate(x) + 4, nchar(out[x]))):
'as.is' should be specified by the caller; using TRUE

Warning in type.convert.default(substr(out[x], locate(x) + 4, nchar(out[x]))):
'as.is' should be specified by the caller; using TRUE

Warning in type.convert.default(substr(out[x], locate(x) + 4, nchar(out[x]))):
'as.is' should be specified by the caller; using TRUE
```

```

Note: only 6 parameters counted of 7 specified parameters
```

```
AICc and parameter count have been adjusted upward
```

```
Warning in readChar(z, 1): la chaîne de caractère est tronquée car un caractère
nul s’y trouve
```

```
Warning in readChar(z, 1): la chaîne de caractère est tronquée car un caractère
nul s’y trouve

Warning in readChar(z, 1): la chaîne de caractère est tronquée car un caractère
nul s’y trouve

Warning in readChar(z, 1): la chaîne de caractère est tronquée car un caractère
nul s’y trouve

Warning in readChar(z, 1): la chaîne de caractère est tronquée car un caractère
nul s’y trouve

Warning in readChar(z, 1): la chaîne de caractère est tronquée car un caractère
nul s’y trouve
```

```

Output summary for CJS model
Name : Phi(~age)p(~1) 

Npar :  7  (unadjusted=6)
-2lnL:  662.8206
AICc :  677.0885  (unadjusted=675.02107)

Beta
                   estimate           se           lcl          ucl
Phi:(Intercept)   0.2052267    0.1393353    -0.0678704    0.4783239
Phi:age1          0.0214787    0.2537612    -0.4758932    0.5188507
Phi:age2          0.3587529    0.3690996    -0.3646823    1.0821880
Phi:age3         -0.0576641    0.5381897    -1.1125160    0.9971879
Phi:age4          0.2395414    0.8866427    -1.4982783    1.9773610
Phi:age5        -18.4888960 4389.8733000 -8622.6407000 8585.6629000
p:(Intercept)     2.2552375    0.3288447     1.6107018    2.8997732


Real Parameter Phi
Group:sexF 
          1         2         3         4         5            6
1 0.5511274 0.5564349 0.6373728 0.5368239 0.6093946 1.146842e-08
2           0.5511274 0.5564349 0.6373728 0.5368239 6.093946e-01
3                     0.5511274 0.5564349 0.6373728 5.368239e-01
4                               0.5511274 0.5564349 6.373728e-01
5                                         0.5511274 5.564349e-01
6                                                   5.511274e-01

Group:sexM 
          1         2         3         4         5            6
1 0.5511274 0.5564349 0.6373728 0.5368239 0.6093946 1.146842e-08
2           0.5511274 0.5564349 0.6373728 0.5368239 6.093946e-01
3                     0.5511274 0.5564349 0.6373728 5.368239e-01
4                               0.5511274 0.5564349 6.373728e-01
5                                         0.5511274 5.564349e-01
6                                                   5.511274e-01


Real Parameter p
Group:sexF 
          2         3         4         5         6         7
1 0.9051014 0.9051014 0.9051014 0.9051014 0.9051014 0.9051014
2           0.9051014 0.9051014 0.9051014 0.9051014 0.9051014
3                     0.9051014 0.9051014 0.9051014 0.9051014
4                               0.9051014 0.9051014 0.9051014
5                                         0.9051014 0.9051014
6                                                   0.9051014

Group:sexM 
          2         3         4         5         6         7
1 0.9051014 0.9051014 0.9051014 0.9051014 0.9051014 0.9051014
2           0.9051014 0.9051014 0.9051014 0.9051014 0.9051014
3                     0.9051014 0.9051014 0.9051014 0.9051014
4                               0.9051014 0.9051014 0.9051014
5                                         0.9051014 0.9051014
6                                                   0.9051014
```

---


```r
phiage.p$results$real
```

```
                    estimate           se           lcl          ucl fixed note
Phi gF c1 a0 t1 5.511274e-01 0.0344696000  4.830389e-01 6.173520e-01           
Phi gF c1 a1 t2 5.564349e-01 0.0502657000  4.569908e-01 6.515533e-01           
Phi gF c1 a2 t3 6.373728e-01 0.0794808000  4.725209e-01 7.752133e-01           
Phi gF c1 a3 t4 5.368239e-01 0.1293733000  2.947852e-01 7.626713e-01           
Phi gF c1 a4 t5 6.093946e-01 0.2089612000  2.182573e-01 8.970980e-01           
Phi gF c1 a5 t6 1.146842e-08 0.0000503449 -9.866454e-05 9.868748e-05           
p gF c1 a1 t2   9.051014e-01 0.0282454000  8.335088e-01 9.478352e-01           
```

---

Create 0, 1+ age variable

```r
dipper.ddl &lt;- add.design.data(dipper.proc,
                              dipper.ddl, # add 2 age-class structure to design matrix
                              "Phi",
                              type = "age",
                              bins = c(0, 1, 7),
                              name = "ageclass",
                              right = FALSE)
```

---


```r
phi.age2 &lt;- list(formula=~ageclass) # age effect on survival
```

---


```r
phiage2.p &lt;- mark(dipper.proc,
                  dipper.ddl,
                  model.parameters = list(Phi = phi.age2, p = p))
```

```
Warning in type.convert.default(substr(out[x], regexpr("=", out[x]) + 1, :
'as.is' should be specified by the caller; using TRUE
```

```
Warning in type.convert.default(substr(out[x], locate(x) + 4, nchar(out[x]))):
'as.is' should be specified by the caller; using TRUE

Warning in type.convert.default(substr(out[x], locate(x) + 4, nchar(out[x]))):
'as.is' should be specified by the caller; using TRUE

Warning in type.convert.default(substr(out[x], locate(x) + 4, nchar(out[x]))):
'as.is' should be specified by the caller; using TRUE

Warning in type.convert.default(substr(out[x], locate(x) + 4, nchar(out[x]))):
'as.is' should be specified by the caller; using TRUE

Warning in type.convert.default(substr(out[x], locate(x) + 4, nchar(out[x]))):
'as.is' should be specified by the caller; using TRUE
```

```
Warning in readChar(z, 1): la chaîne de caractère est tronquée car un caractère
nul s’y trouve

Warning in readChar(z, 1): la chaîne de caractère est tronquée car un caractère
nul s’y trouve

Warning in readChar(z, 1): la chaîne de caractère est tronquée car un caractère
nul s’y trouve

Warning in readChar(z, 1): la chaîne de caractère est tronquée car un caractère
nul s’y trouve

Warning in readChar(z, 1): la chaîne de caractère est tronquée car un caractère
nul s’y trouve

Warning in readChar(z, 1): la chaîne de caractère est tronquée car un caractère
nul s’y trouve
```

```

Output summary for CJS model
Name : Phi(~ageclass)p(~1) 

Npar :  3
-2lnL:  666.6804
AICc :  672.7373

Beta
                   estimate        se        lcl       ucl
Phi:(Intercept)   0.2041822 0.1390053 -0.0682681 0.4766326
Phi:ageclass[1,7] 0.0841951 0.2119782 -0.3312822 0.4996724
p:(Intercept)     2.2456920 0.3285356  1.6017623 2.8896217


Real Parameter Phi
Group:sexF 
         1         2         3         4         5         6
1 0.550869 0.5715988 0.5715988 0.5715988 0.5715988 0.5715988
2          0.5508690 0.5715988 0.5715988 0.5715988 0.5715988
3                    0.5508690 0.5715988 0.5715988 0.5715988
4                              0.5508690 0.5715988 0.5715988
5                                        0.5508690 0.5715988
6                                                  0.5508690

Group:sexM 
         1         2         3         4         5         6
1 0.550869 0.5715988 0.5715988 0.5715988 0.5715988 0.5715988
2          0.5508690 0.5715988 0.5715988 0.5715988 0.5715988
3                    0.5508690 0.5715988 0.5715988 0.5715988
4                              0.5508690 0.5715988 0.5715988
5                                        0.5508690 0.5715988
6                                                  0.5508690


Real Parameter p
Group:sexF 
          2         3         4         5         6         7
1 0.9042783 0.9042783 0.9042783 0.9042783 0.9042783 0.9042783
2           0.9042783 0.9042783 0.9042783 0.9042783 0.9042783
3                     0.9042783 0.9042783 0.9042783 0.9042783
4                               0.9042783 0.9042783 0.9042783
5                                         0.9042783 0.9042783
6                                                   0.9042783

Group:sexM 
          2         3         4         5         6         7
1 0.9042783 0.9042783 0.9042783 0.9042783 0.9042783 0.9042783
2           0.9042783 0.9042783 0.9042783 0.9042783 0.9042783
3                     0.9042783 0.9042783 0.9042783 0.9042783
4                               0.9042783 0.9042783 0.9042783
5                                         0.9042783 0.9042783
6                                                   0.9042783
```

---


```r
phiage2.p$results$real
```

```
                 estimate        se       lcl       ucl fixed note
Phi gF c1 a0 t1 0.5508690 0.0343916 0.4829396 0.6169524           
Phi gF c1 a1 t2 0.5715988 0.0380167 0.4960218 0.6439770           
p gF c1 a1 t2   0.9042783 0.0284377 0.8322645 0.9473310           
```



---
class: center, middle
background-size: cover

## Live demo #5: Multisite capture-recapture models

---

## Read in data (1)

Read in csv file:

```r
geese_csv &lt;- read_csv2("dat/allgeese.csv")
```

```
ℹ Using "','" as decimal and "'.'" as grouping mark. Use `read_delim()` for more control.
```

```
Rows: 623 Columns: 7
```

```
── Column specification ────────────────────────────────────────────────────────
Delimiter: ";"
dbl (7): year_1984, year_1985, year_1986, year_1987, year_1988, year_1989, N
```

```

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.
```

---
## Read in data (2)


```r
geese_csv
```

```
# A tibble: 623 × 7
   year_1984 year_1985 year_1986 year_1987 year_1988 year_1989     N
       &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt;
 1         0         0         0         0         0         1   158
 2         0         0         0         0         0         2   352
 3         0         0         0         0         0         3   271
 4         0         0         0         0         1         0   317
 5         0         0         0         0         1         1    62
 6         0         0         0         0         1         2    31
 7         0         0         0         0         2         0   748
 8         0         0         0         0         2         1    56
 9         0         0         0         0         2         2   234
10         0         0         0         0         2         3     7
# … with 613 more rows
```

---
## Convert to Mark format (1)

Build a data.frame with encounter histories, and number of individuals:

```r
geese &lt;- data.frame(ch = unite(geese_csv %&gt;% select(year_1984:year_1989), 
                               col = "ch", 
                               sep = ""), 
                    freq = geese_csv$N)
```

---
## Convert to Mark format (2)

Inspect first lines:

```r
head(geese)
```

```
      ch freq
1 000001  158
2 000002  352
3 000003  271
4 000010  317
5 000011   62
6 000012   31
```

---


```r
geese.proc &lt;- process.data(data = geese,
                           model = "Multistrata")
```

---


```r
geese.ddl &lt;- make.design.data(geese.proc)
```

---


```r
# Define survival probability 
S &lt;- list(formula=~1) # survival constant 
S.site &lt;- list(formula=~stratum) # survival depends on states 
# Define detection probability 
p &lt;- list(formula=~1) # constant over time, does not depend on states 
# Define transition probs 
Psi.site &lt;- list(formula=~-1+stratum:tostratum,link='mlogit')
```

---

Run model with state effect on survival 

```r
phis.psi.p &lt;- mark(geese.proc,
                   geese.ddl,
                   model.parameters=list(S = S.site,
                                         p = p,
                                         Psi=Psi.site))
```

```
Warning in type.convert.default(substr(out[x], regexpr("=", out[x]) + 1, :
'as.is' should be specified by the caller; using TRUE
```

```
Warning in type.convert.default(substr(out[x], locate(x) + 4, nchar(out[x]))):
'as.is' should be specified by the caller; using TRUE

Warning in type.convert.default(substr(out[x], locate(x) + 4, nchar(out[x]))):
'as.is' should be specified by the caller; using TRUE

Warning in type.convert.default(substr(out[x], locate(x) + 4, nchar(out[x]))):
'as.is' should be specified by the caller; using TRUE

Warning in type.convert.default(substr(out[x], locate(x) + 4, nchar(out[x]))):
'as.is' should be specified by the caller; using TRUE

Warning in type.convert.default(substr(out[x], locate(x) + 4, nchar(out[x]))):
'as.is' should be specified by the caller; using TRUE
```

```
Warning in readChar(z, 1): la chaîne de caractère est tronquée car un caractère
nul s’y trouve

Warning in readChar(z, 1): la chaîne de caractère est tronquée car un caractère
nul s’y trouve

Warning in readChar(z, 1): la chaîne de caractère est tronquée car un caractère
nul s’y trouve

Warning in readChar(z, 1): la chaîne de caractère est tronquée car un caractère
nul s’y trouve

Warning in readChar(z, 1): la chaîne de caractère est tronquée car un caractère
nul s’y trouve

Warning in readChar(z, 1): la chaîne de caractère est tronquée car un caractère
nul s’y trouve
```

```

Output summary for Multistrata model
Name : S(~stratum)p(~1)Psi(~-1 + stratum:tostratum) 

Npar :  10
-2lnL:  73743.06
AICc :  73763.07

Beta
                          estimate        se        lcl        ucl
S:(Intercept)            0.7203380 0.0312783  0.6590325  0.7816435
S:stratum2               0.0490011 0.0378226 -0.0251312  0.1231334
S:stratum3              -0.1533416 0.0488370 -0.2490621 -0.0576211
p:(Intercept)           -0.3361520 0.0195059 -0.3743836 -0.2979204
Psi:stratum2:tostratum1 -1.9884650 0.0351679 -2.0573941 -1.9195358
Psi:stratum3:tostratum1 -2.5006505 0.1011618 -2.6989276 -2.3023733
Psi:stratum1:tostratum2 -1.1409126 0.0367455 -1.2129339 -1.0688914
Psi:stratum3:tostratum2 -0.8726951 0.0489215 -0.9685812 -0.7768090
Psi:stratum1:tostratum3 -4.9500374 0.2335498 -5.4077950 -4.4922799
Psi:stratum2:tostratum3 -3.6657287 0.0775562 -3.8177387 -3.5137186


Real Parameter S
 Stratum:1 
          1         2         3         4         5
1 0.6726814 0.6726814 0.6726814 0.6726814 0.6726814
2           0.6726814 0.6726814 0.6726814 0.6726814
3                     0.6726814 0.6726814 0.6726814
4                               0.6726814 0.6726814
5                                         0.6726814

 Stratum:2 
          1         2         3         4         5
1 0.6833779 0.6833779 0.6833779 0.6833779 0.6833779
2           0.6833779 0.6833779 0.6833779 0.6833779
3                     0.6833779 0.6833779 0.6833779
4                               0.6833779 0.6833779
5                                         0.6833779

 Stratum:3 
          1         2         3         4         5
1 0.6380698 0.6380698 0.6380698 0.6380698 0.6380698
2           0.6380698 0.6380698 0.6380698 0.6380698
3                     0.6380698 0.6380698 0.6380698
4                               0.6380698 0.6380698
5                                         0.6380698


Real Parameter p
 Stratum:1 
          2         3         4         5         6
1 0.4167445 0.4167445 0.4167445 0.4167445 0.4167445
2           0.4167445 0.4167445 0.4167445 0.4167445
3                     0.4167445 0.4167445 0.4167445
4                               0.4167445 0.4167445
5                                         0.4167445

 Stratum:2 
          2         3         4         5         6
1 0.4167445 0.4167445 0.4167445 0.4167445 0.4167445
2           0.4167445 0.4167445 0.4167445 0.4167445
3                     0.4167445 0.4167445 0.4167445
4                               0.4167445 0.4167445
5                                         0.4167445

 Stratum:3 
          2         3         4         5         6
1 0.4167445 0.4167445 0.4167445 0.4167445 0.4167445
2           0.4167445 0.4167445 0.4167445 0.4167445
3                     0.4167445 0.4167445 0.4167445
4                               0.4167445 0.4167445
5                                         0.4167445


Real Parameter Psi
 Stratum:1 To:2 
          1         2         3         4         5
1 0.2408599 0.2408599 0.2408599 0.2408599 0.2408599
2           0.2408599 0.2408599 0.2408599 0.2408599
3                     0.2408599 0.2408599 0.2408599
4                               0.2408599 0.2408599
5                                         0.2408599

 Stratum:1 To:3 
          1         2         3         4         5
1 0.0053393 0.0053393 0.0053393 0.0053393 0.0053393
2           0.0053393 0.0053393 0.0053393 0.0053393
3                     0.0053393 0.0053393 0.0053393
4                               0.0053393 0.0053393
5                                         0.0053393

 Stratum:2 To:1 
         1        2        3        4        5
1 0.117769 0.117769 0.117769 0.117769 0.117769
2          0.117769 0.117769 0.117769 0.117769
3                   0.117769 0.117769 0.117769
4                            0.117769 0.117769
5                                     0.117769

 Stratum:2 To:3 
          1         2         3         4         5
1 0.0220092 0.0220092 0.0220092 0.0220092 0.0220092
2           0.0220092 0.0220092 0.0220092 0.0220092
3                     0.0220092 0.0220092 0.0220092
4                               0.0220092 0.0220092
5                                         0.0220092

 Stratum:3 To:1 
         1        2        3        4        5
1 0.054693 0.054693 0.054693 0.054693 0.054693
2          0.054693 0.054693 0.054693 0.054693
3                   0.054693 0.054693 0.054693
4                            0.054693 0.054693
5                                     0.054693

 Stratum:3 To:2 
          1         2         3         4         5
1 0.2785761 0.2785761 0.2785761 0.2785761 0.2785761
2           0.2785761 0.2785761 0.2785761 0.2785761
3                     0.2785761 0.2785761 0.2785761
4                               0.2785761 0.2785761
5                                         0.2785761
```


---


```r
phis.psi.p$results$real
```

```
                           estimate        se       lcl       ucl fixed note
S s1 g1 c1 a0 o1 t1       0.6726814 0.0068869 0.6590430 0.6860342           
S s2 g1 c1 a0 o1 t1       0.6833779 0.0050722 0.6733537 0.6932346           
S s3 g1 c1 a0 o1 t1       0.6380698 0.0094720 0.6193064 0.6564215           
p s1 g1 c1 a1 o1 t2       0.4167445 0.0047413 0.4074822 0.4260659           
Psi s1 to2 g1 c1 a0 o1 t1 0.2408599 0.0067228 0.2279302 0.2542815           
Psi s1 to2 g1 c1 a1 o2 t2 0.2408599 0.0067228 0.2279302 0.2542815           
Psi s1 to2 g1 c1 a2 o3 t3 0.2408599 0.0067228 0.2279302 0.2542815           
Psi s1 to2 g1 c1 a3 o4 t4 0.2408599 0.0067228 0.2279302 0.2542815           
Psi s1 to2 g1 c1 a4 o5 t5 0.2408599 0.0067228 0.2279302 0.2542815           
Psi s1 to2 g1 c2 a0 o2 t2 0.2408599 0.0067228 0.2279302 0.2542815           
Psi s1 to2 g1 c2 a1 o3 t3 0.2408599 0.0067228 0.2279302 0.2542815           
Psi s1 to2 g1 c2 a2 o4 t4 0.2408599 0.0067228 0.2279302 0.2542815           
Psi s1 to2 g1 c2 a3 o5 t5 0.2408599 0.0067228 0.2279302 0.2542815           
Psi s1 to2 g1 c3 a0 o3 t3 0.2408599 0.0067228 0.2279302 0.2542815           
Psi s1 to2 g1 c3 a1 o4 t4 0.2408599 0.0067228 0.2279302 0.2542815           
Psi s1 to2 g1 c3 a2 o5 t5 0.2408599 0.0067228 0.2279302 0.2542815           
Psi s1 to2 g1 c4 a0 o4 t4 0.2408599 0.0067228 0.2279302 0.2542815           
Psi s1 to2 g1 c4 a1 o5 t5 0.2408599 0.0067228 0.2279302 0.2542815           
Psi s1 to2 g1 c5 a0 o5 t5 0.2408599 0.0067228 0.2279302 0.2542815           
Psi s1 to3 g1 c1 a0 o1 t1 0.0053393 0.0012408 0.0033842 0.0084143           
Psi s1 to3 g1 c1 a1 o2 t2 0.0053393 0.0012408 0.0033842 0.0084143           
Psi s1 to3 g1 c1 a2 o3 t3 0.0053393 0.0012408 0.0033842 0.0084143           
Psi s1 to3 g1 c1 a3 o4 t4 0.0053393 0.0012408 0.0033842 0.0084143           
Psi s1 to3 g1 c1 a4 o5 t5 0.0053393 0.0012408 0.0033842 0.0084143           
Psi s1 to3 g1 c2 a0 o2 t2 0.0053393 0.0012408 0.0033842 0.0084143           
Psi s1 to3 g1 c2 a1 o3 t3 0.0053393 0.0012408 0.0033842 0.0084143           
Psi s1 to3 g1 c2 a2 o4 t4 0.0053393 0.0012408 0.0033842 0.0084143           
Psi s1 to3 g1 c2 a3 o5 t5 0.0053393 0.0012408 0.0033842 0.0084143           
Psi s1 to3 g1 c3 a0 o3 t3 0.0053393 0.0012408 0.0033842 0.0084143           
Psi s1 to3 g1 c3 a1 o4 t4 0.0053393 0.0012408 0.0033842 0.0084143           
Psi s1 to3 g1 c3 a2 o5 t5 0.0053393 0.0012408 0.0033842 0.0084143           
Psi s1 to3 g1 c4 a0 o4 t4 0.0053393 0.0012408 0.0033842 0.0084143           
Psi s1 to3 g1 c4 a1 o5 t5 0.0053393 0.0012408 0.0033842 0.0084143           
Psi s1 to3 g1 c5 a0 o5 t5 0.0053393 0.0012408 0.0033842 0.0084143           
Psi s2 to1 g1 c1 a0 o1 t1 0.1177690 0.0036470 0.1108067 0.1251073           
Psi s2 to1 g1 c1 a1 o2 t2 0.1177690 0.0036470 0.1108067 0.1251073           
Psi s2 to1 g1 c1 a2 o3 t3 0.1177690 0.0036470 0.1108067 0.1251073           
Psi s2 to1 g1 c1 a3 o4 t4 0.1177690 0.0036470 0.1108067 0.1251073           
Psi s2 to1 g1 c1 a4 o5 t5 0.1177690 0.0036470 0.1108067 0.1251073           
Psi s2 to1 g1 c2 a0 o2 t2 0.1177690 0.0036470 0.1108067 0.1251073           
Psi s2 to1 g1 c2 a1 o3 t3 0.1177690 0.0036470 0.1108067 0.1251073           
Psi s2 to1 g1 c2 a2 o4 t4 0.1177690 0.0036470 0.1108067 0.1251073           
Psi s2 to1 g1 c2 a3 o5 t5 0.1177690 0.0036470 0.1108067 0.1251073           
Psi s2 to1 g1 c3 a0 o3 t3 0.1177690 0.0036470 0.1108067 0.1251073           
Psi s2 to1 g1 c3 a1 o4 t4 0.1177690 0.0036470 0.1108067 0.1251073           
Psi s2 to1 g1 c3 a2 o5 t5 0.1177690 0.0036470 0.1108067 0.1251073           
Psi s2 to1 g1 c4 a0 o4 t4 0.1177690 0.0036470 0.1108067 0.1251073           
Psi s2 to1 g1 c4 a1 o5 t5 0.1177690 0.0036470 0.1108067 0.1251073           
Psi s2 to1 g1 c5 a0 o5 t5 0.1177690 0.0036470 0.1108067 0.1251073           
Psi s2 to3 g1 c1 a0 o1 t1 0.0220092 0.0016662 0.0189697 0.0255231           
Psi s2 to3 g1 c1 a1 o2 t2 0.0220092 0.0016662 0.0189697 0.0255231           
Psi s2 to3 g1 c1 a2 o3 t3 0.0220092 0.0016662 0.0189697 0.0255231           
Psi s2 to3 g1 c1 a3 o4 t4 0.0220092 0.0016662 0.0189697 0.0255231           
Psi s2 to3 g1 c1 a4 o5 t5 0.0220092 0.0016662 0.0189697 0.0255231           
Psi s2 to3 g1 c2 a0 o2 t2 0.0220092 0.0016662 0.0189697 0.0255231           
Psi s2 to3 g1 c2 a1 o3 t3 0.0220092 0.0016662 0.0189697 0.0255231           
Psi s2 to3 g1 c2 a2 o4 t4 0.0220092 0.0016662 0.0189697 0.0255231           
Psi s2 to3 g1 c2 a3 o5 t5 0.0220092 0.0016662 0.0189697 0.0255231           
Psi s2 to3 g1 c3 a0 o3 t3 0.0220092 0.0016662 0.0189697 0.0255231           
Psi s2 to3 g1 c3 a1 o4 t4 0.0220092 0.0016662 0.0189697 0.0255231           
Psi s2 to3 g1 c3 a2 o5 t5 0.0220092 0.0016662 0.0189697 0.0255231           
Psi s2 to3 g1 c4 a0 o4 t4 0.0220092 0.0016662 0.0189697 0.0255231           
Psi s2 to3 g1 c4 a1 o5 t5 0.0220092 0.0016662 0.0189697 0.0255231           
Psi s2 to3 g1 c5 a0 o5 t5 0.0220092 0.0016662 0.0189697 0.0255231           
Psi s3 to1 g1 c1 a0 o1 t1 0.0546930 0.0052218 0.0453155 0.0658771           
Psi s3 to1 g1 c1 a1 o2 t2 0.0546930 0.0052218 0.0453155 0.0658771           
Psi s3 to1 g1 c1 a2 o3 t3 0.0546930 0.0052218 0.0453155 0.0658771           
Psi s3 to1 g1 c1 a3 o4 t4 0.0546930 0.0052218 0.0453155 0.0658771           
Psi s3 to1 g1 c1 a4 o5 t5 0.0546930 0.0052218 0.0453155 0.0658771           
Psi s3 to1 g1 c2 a0 o2 t2 0.0546930 0.0052218 0.0453155 0.0658771           
Psi s3 to1 g1 c2 a1 o3 t3 0.0546930 0.0052218 0.0453155 0.0658771           
Psi s3 to1 g1 c2 a2 o4 t4 0.0546930 0.0052218 0.0453155 0.0658771           
Psi s3 to1 g1 c2 a3 o5 t5 0.0546930 0.0052218 0.0453155 0.0658771           
Psi s3 to1 g1 c3 a0 o3 t3 0.0546930 0.0052218 0.0453155 0.0658771           
Psi s3 to1 g1 c3 a1 o4 t4 0.0546930 0.0052218 0.0453155 0.0658771           
Psi s3 to1 g1 c3 a2 o5 t5 0.0546930 0.0052218 0.0453155 0.0658771           
Psi s3 to1 g1 c4 a0 o4 t4 0.0546930 0.0052218 0.0453155 0.0658771           
Psi s3 to1 g1 c4 a1 o5 t5 0.0546930 0.0052218 0.0453155 0.0658771           
Psi s3 to1 g1 c5 a0 o5 t5 0.0546930 0.0052218 0.0453155 0.0658771           
Psi s3 to2 g1 c1 a0 o1 t1 0.2785761 0.0098254 0.2597327 0.2982359           
Psi s3 to2 g1 c1 a1 o2 t2 0.2785761 0.0098254 0.2597327 0.2982359           
Psi s3 to2 g1 c1 a2 o3 t3 0.2785761 0.0098254 0.2597327 0.2982359           
Psi s3 to2 g1 c1 a3 o4 t4 0.2785761 0.0098254 0.2597327 0.2982359           
Psi s3 to2 g1 c1 a4 o5 t5 0.2785761 0.0098254 0.2597327 0.2982359           
Psi s3 to2 g1 c2 a0 o2 t2 0.2785761 0.0098254 0.2597327 0.2982359           
Psi s3 to2 g1 c2 a1 o3 t3 0.2785761 0.0098254 0.2597327 0.2982359           
Psi s3 to2 g1 c2 a2 o4 t4 0.2785761 0.0098254 0.2597327 0.2982359           
Psi s3 to2 g1 c2 a3 o5 t5 0.2785761 0.0098254 0.2597327 0.2982359           
Psi s3 to2 g1 c3 a0 o3 t3 0.2785761 0.0098254 0.2597327 0.2982359           
Psi s3 to2 g1 c3 a1 o4 t4 0.2785761 0.0098254 0.2597327 0.2982359           
Psi s3 to2 g1 c3 a2 o5 t5 0.2785761 0.0098254 0.2597327 0.2982359           
Psi s3 to2 g1 c4 a0 o4 t4 0.2785761 0.0098254 0.2597327 0.2982359           
Psi s3 to2 g1 c4 a1 o5 t5 0.2785761 0.0098254 0.2597327 0.2982359           
Psi s3 to2 g1 c5 a0 o5 t5 0.2785761 0.0098254 0.2597327 0.2982359           
```

---


```r
Psilist &lt;- get.real(phis.psi.p, "Psi", vcv = TRUE)
Psi.values = Psilist$estimates
top.psi = TransitionMatrix(Psi.values[Psi.values$time == 1, ], 
                           vcv.real = Psilist$vcv.real)
top.psi
```

```
$TransitionMat
           1         2          3
1 0.75380080 0.2408599 0.00533928
2 0.11776902 0.8602218 0.02200922
3 0.05469301 0.2785761 0.66673086

$se.TransitionMat
            1           2           3
1 0.006745688 0.006722834 0.001240810
2 0.003647023 0.003936541 0.001666231
3 0.005221789 0.009825355 0.010085026

$lcl.TransitionMat
           1         2           3
1 0.74034158 0.2279302 0.003384207
2 0.11080669 0.8523264 0.018969671
3 0.04531555 0.2597327 0.646680037

$ucl.TransitionMat
           1         2           3
1 0.76678213 0.2542815 0.008414272
2 0.12510726 0.8677605 0.025523134
3 0.06587712 0.2982359 0.686195969
```

---

Run model with state effect on survival 

```r
phi.psi.p &lt;- mark(geese.proc,
                   geese.ddl,
                   model.parameters=list(S = S,
                                         p = p,
                                         Psi=Psi.site))
```

```
Warning in type.convert.default(substr(out[x], regexpr("=", out[x]) + 1, :
'as.is' should be specified by the caller; using TRUE
```

```
Warning in type.convert.default(substr(out[x], locate(x) + 4, nchar(out[x]))):
'as.is' should be specified by the caller; using TRUE

Warning in type.convert.default(substr(out[x], locate(x) + 4, nchar(out[x]))):
'as.is' should be specified by the caller; using TRUE

Warning in type.convert.default(substr(out[x], locate(x) + 4, nchar(out[x]))):
'as.is' should be specified by the caller; using TRUE

Warning in type.convert.default(substr(out[x], locate(x) + 4, nchar(out[x]))):
'as.is' should be specified by the caller; using TRUE

Warning in type.convert.default(substr(out[x], locate(x) + 4, nchar(out[x]))):
'as.is' should be specified by the caller; using TRUE
```

```
Warning in readChar(z, 1): la chaîne de caractère est tronquée car un caractère
nul s’y trouve

Warning in readChar(z, 1): la chaîne de caractère est tronquée car un caractère
nul s’y trouve

Warning in readChar(z, 1): la chaîne de caractère est tronquée car un caractère
nul s’y trouve

Warning in readChar(z, 1): la chaîne de caractère est tronquée car un caractère
nul s’y trouve

Warning in readChar(z, 1): la chaîne de caractère est tronquée car un caractère
nul s’y trouve

Warning in readChar(z, 1): la chaîne de caractère est tronquée car un caractère
nul s’y trouve
```

```

Output summary for Multistrata model
Name : S(~1)p(~1)Psi(~-1 + stratum:tostratum) 

Npar :  8
-2lnL:  73762.35
AICc :  73778.35

Beta
                          estimate        se        lcl        ucl
S:(Intercept)            0.7285804 0.0183463  0.6926217  0.7645390
p:(Intercept)           -0.3409442 0.0194757 -0.3791166 -0.3027717
Psi:stratum2:tostratum1 -1.9911509 0.0351079 -2.0599624 -1.9223393
Psi:stratum3:tostratum1 -2.4855121 0.1007715 -2.6830243 -2.2879999
Psi:stratum1:tostratum2 -1.1367655 0.0365654 -1.2084337 -1.0650973
Psi:stratum3:tostratum2 -0.8560151 0.0486932 -0.9514537 -0.7605764
Psi:stratum1:tostratum3 -4.9580431 0.2326096 -5.4139579 -4.5021283
Psi:stratum2:tostratum3 -3.6807680 0.0775501 -3.8327663 -3.5287698


Real Parameter S
 Stratum:1 
          1         2         3         4         5
1 0.6744937 0.6744937 0.6744937 0.6744937 0.6744937
2           0.6744937 0.6744937 0.6744937 0.6744937
3                     0.6744937 0.6744937 0.6744937
4                               0.6744937 0.6744937
5                                         0.6744937

 Stratum:2 
          1         2         3         4         5
1 0.6744937 0.6744937 0.6744937 0.6744937 0.6744937
2           0.6744937 0.6744937 0.6744937 0.6744937
3                     0.6744937 0.6744937 0.6744937
4                               0.6744937 0.6744937
5                                         0.6744937

 Stratum:3 
          1         2         3         4         5
1 0.6744937 0.6744937 0.6744937 0.6744937 0.6744937
2           0.6744937 0.6744937 0.6744937 0.6744937
3                     0.6744937 0.6744937 0.6744937
4                               0.6744937 0.6744937
5                                         0.6744937


Real Parameter p
 Stratum:1 
          2         3         4         5         6
1 0.4155801 0.4155801 0.4155801 0.4155801 0.4155801
2           0.4155801 0.4155801 0.4155801 0.4155801
3                     0.4155801 0.4155801 0.4155801
4                               0.4155801 0.4155801
5                                         0.4155801

 Stratum:2 
          2         3         4         5         6
1 0.4155801 0.4155801 0.4155801 0.4155801 0.4155801
2           0.4155801 0.4155801 0.4155801 0.4155801
3                     0.4155801 0.4155801 0.4155801
4                               0.4155801 0.4155801
5                                         0.4155801

 Stratum:3 
          2         3         4         5         6
1 0.4155801 0.4155801 0.4155801 0.4155801 0.4155801
2           0.4155801 0.4155801 0.4155801 0.4155801
3                     0.4155801 0.4155801 0.4155801
4                               0.4155801 0.4155801
5                                         0.4155801


Real Parameter Psi
 Stratum:1 To:2 
          1         2         3         4         5
1 0.2416293 0.2416293 0.2416293 0.2416293 0.2416293
2           0.2416293 0.2416293 0.2416293 0.2416293
3                     0.2416293 0.2416293 0.2416293
4                               0.2416293 0.2416293
5                                         0.2416293

 Stratum:1 To:3 
          1         2         3         4         5
1 0.0052916 0.0052916 0.0052916 0.0052916 0.0052916
2           0.0052916 0.0052916 0.0052916 0.0052916
3                     0.0052916 0.0052916 0.0052916
4                               0.0052916 0.0052916
5                                         0.0052916

 Stratum:2 To:1 
          1         2         3         4         5
1 0.1175289 0.1175289 0.1175289 0.1175289 0.1175289
2           0.1175289 0.1175289 0.1175289 0.1175289
3                     0.1175289 0.1175289 0.1175289
4                               0.1175289 0.1175289
5                                         0.1175289

 Stratum:2 To:3 
          1         2         3         4         5
1 0.0216947 0.0216947 0.0216947 0.0216947 0.0216947
2           0.0216947 0.0216947 0.0216947 0.0216947
3                     0.0216947 0.0216947 0.0216947
4                               0.0216947 0.0216947
5                                         0.0216947

 Stratum:3 To:1 
          1         2         3         4         5
1 0.0552225 0.0552225 0.0552225 0.0552225 0.0552225
2           0.0552225 0.0552225 0.0552225 0.0552225
3                     0.0552225 0.0552225 0.0552225
4                               0.0552225 0.0552225
5                                         0.0552225

 Stratum:3 To:2 
          1         2         3         4         5
1 0.2817068 0.2817068 0.2817068 0.2817068 0.2817068
2           0.2817068 0.2817068 0.2817068 0.2817068
3                     0.2817068 0.2817068 0.2817068
4                               0.2817068 0.2817068
5                                         0.2817068
```


---


```r
phi.psi.p$results$real
```

```
                           estimate        se       lcl       ucl fixed note
S s1 g1 c1 a0 o1 t1       0.6744937 0.0040280 0.6665499 0.6823384           
p s1 g1 c1 a1 o1 t2       0.4155801 0.0047301 0.4063400 0.4248800           
Psi s1 to2 g1 c1 a0 o1 t1 0.2416293 0.0067048 0.2287323 0.2550131           
Psi s1 to2 g1 c1 a1 o2 t2 0.2416293 0.0067048 0.2287323 0.2550131           
Psi s1 to2 g1 c1 a2 o3 t3 0.2416293 0.0067048 0.2287323 0.2550131           
Psi s1 to2 g1 c1 a3 o4 t4 0.2416293 0.0067048 0.2287323 0.2550131           
Psi s1 to2 g1 c1 a4 o5 t5 0.2416293 0.0067048 0.2287323 0.2550131           
Psi s1 to2 g1 c2 a0 o2 t2 0.2416293 0.0067048 0.2287323 0.2550131           
Psi s1 to2 g1 c2 a1 o3 t3 0.2416293 0.0067048 0.2287323 0.2550131           
Psi s1 to2 g1 c2 a2 o4 t4 0.2416293 0.0067048 0.2287323 0.2550131           
Psi s1 to2 g1 c2 a3 o5 t5 0.2416293 0.0067048 0.2287323 0.2550131           
Psi s1 to2 g1 c3 a0 o3 t3 0.2416293 0.0067048 0.2287323 0.2550131           
Psi s1 to2 g1 c3 a1 o4 t4 0.2416293 0.0067048 0.2287323 0.2550131           
Psi s1 to2 g1 c3 a2 o5 t5 0.2416293 0.0067048 0.2287323 0.2550131           
Psi s1 to2 g1 c4 a0 o4 t4 0.2416293 0.0067048 0.2287323 0.2550131           
Psi s1 to2 g1 c4 a1 o5 t5 0.2416293 0.0067048 0.2287323 0.2550131           
Psi s1 to2 g1 c5 a0 o5 t5 0.2416293 0.0067048 0.2287323 0.2550131           
Psi s1 to3 g1 c1 a0 o1 t1 0.0052916 0.0012249 0.0033600 0.0083244           
Psi s1 to3 g1 c1 a1 o2 t2 0.0052916 0.0012249 0.0033600 0.0083244           
Psi s1 to3 g1 c1 a2 o3 t3 0.0052916 0.0012249 0.0033600 0.0083244           
Psi s1 to3 g1 c1 a3 o4 t4 0.0052916 0.0012249 0.0033600 0.0083244           
Psi s1 to3 g1 c1 a4 o5 t5 0.0052916 0.0012249 0.0033600 0.0083244           
Psi s1 to3 g1 c2 a0 o2 t2 0.0052916 0.0012249 0.0033600 0.0083244           
Psi s1 to3 g1 c2 a1 o3 t3 0.0052916 0.0012249 0.0033600 0.0083244           
Psi s1 to3 g1 c2 a2 o4 t4 0.0052916 0.0012249 0.0033600 0.0083244           
Psi s1 to3 g1 c2 a3 o5 t5 0.0052916 0.0012249 0.0033600 0.0083244           
Psi s1 to3 g1 c3 a0 o3 t3 0.0052916 0.0012249 0.0033600 0.0083244           
Psi s1 to3 g1 c3 a1 o4 t4 0.0052916 0.0012249 0.0033600 0.0083244           
Psi s1 to3 g1 c3 a2 o5 t5 0.0052916 0.0012249 0.0033600 0.0083244           
Psi s1 to3 g1 c4 a0 o4 t4 0.0052916 0.0012249 0.0033600 0.0083244           
Psi s1 to3 g1 c4 a1 o5 t5 0.0052916 0.0012249 0.0033600 0.0083244           
Psi s1 to3 g1 c5 a0 o5 t5 0.0052916 0.0012249 0.0033600 0.0083244           
Psi s2 to1 g1 c1 a0 o1 t1 0.1175289 0.0036343 0.1105906 0.1248413           
Psi s2 to1 g1 c1 a1 o2 t2 0.1175289 0.0036343 0.1105906 0.1248413           
Psi s2 to1 g1 c1 a2 o3 t3 0.1175289 0.0036343 0.1105906 0.1248413           
Psi s2 to1 g1 c1 a3 o4 t4 0.1175289 0.0036343 0.1105906 0.1248413           
Psi s2 to1 g1 c1 a4 o5 t5 0.1175289 0.0036343 0.1105906 0.1248413           
Psi s2 to1 g1 c2 a0 o2 t2 0.1175289 0.0036343 0.1105906 0.1248413           
Psi s2 to1 g1 c2 a1 o3 t3 0.1175289 0.0036343 0.1105906 0.1248413           
Psi s2 to1 g1 c2 a2 o4 t4 0.1175289 0.0036343 0.1105906 0.1248413           
Psi s2 to1 g1 c2 a3 o5 t5 0.1175289 0.0036343 0.1105906 0.1248413           
Psi s2 to1 g1 c3 a0 o3 t3 0.1175289 0.0036343 0.1105906 0.1248413           
Psi s2 to1 g1 c3 a1 o4 t4 0.1175289 0.0036343 0.1105906 0.1248413           
Psi s2 to1 g1 c3 a2 o5 t5 0.1175289 0.0036343 0.1105906 0.1248413           
Psi s2 to1 g1 c4 a0 o4 t4 0.1175289 0.0036343 0.1105906 0.1248413           
Psi s2 to1 g1 c4 a1 o5 t5 0.1175289 0.0036343 0.1105906 0.1248413           
Psi s2 to1 g1 c5 a0 o5 t5 0.1175289 0.0036343 0.1105906 0.1248413           
Psi s2 to3 g1 c1 a0 o1 t1 0.0216947 0.0016428 0.0186980 0.0251593           
Psi s2 to3 g1 c1 a1 o2 t2 0.0216947 0.0016428 0.0186980 0.0251593           
Psi s2 to3 g1 c1 a2 o3 t3 0.0216947 0.0016428 0.0186980 0.0251593           
Psi s2 to3 g1 c1 a3 o4 t4 0.0216947 0.0016428 0.0186980 0.0251593           
Psi s2 to3 g1 c1 a4 o5 t5 0.0216947 0.0016428 0.0186980 0.0251593           
Psi s2 to3 g1 c2 a0 o2 t2 0.0216947 0.0016428 0.0186980 0.0251593           
Psi s2 to3 g1 c2 a1 o3 t3 0.0216947 0.0016428 0.0186980 0.0251593           
Psi s2 to3 g1 c2 a2 o4 t4 0.0216947 0.0016428 0.0186980 0.0251593           
Psi s2 to3 g1 c2 a3 o5 t5 0.0216947 0.0016428 0.0186980 0.0251593           
Psi s2 to3 g1 c3 a0 o3 t3 0.0216947 0.0016428 0.0186980 0.0251593           
Psi s2 to3 g1 c3 a1 o4 t4 0.0216947 0.0016428 0.0186980 0.0251593           
Psi s2 to3 g1 c3 a2 o5 t5 0.0216947 0.0016428 0.0186980 0.0251593           
Psi s2 to3 g1 c4 a0 o4 t4 0.0216947 0.0016428 0.0186980 0.0251593           
Psi s2 to3 g1 c4 a1 o5 t5 0.0216947 0.0016428 0.0186980 0.0251593           
Psi s2 to3 g1 c5 a0 o5 t5 0.0216947 0.0016428 0.0186980 0.0251593           
Psi s3 to1 g1 c1 a0 o1 t1 0.0552225 0.0052513 0.0457883 0.0664650           
Psi s3 to1 g1 c1 a1 o2 t2 0.0552225 0.0052513 0.0457883 0.0664650           
Psi s3 to1 g1 c1 a2 o3 t3 0.0552225 0.0052513 0.0457883 0.0664650           
Psi s3 to1 g1 c1 a3 o4 t4 0.0552225 0.0052513 0.0457883 0.0664650           
Psi s3 to1 g1 c1 a4 o5 t5 0.0552225 0.0052513 0.0457883 0.0664650           
Psi s3 to1 g1 c2 a0 o2 t2 0.0552225 0.0052513 0.0457883 0.0664650           
Psi s3 to1 g1 c2 a1 o3 t3 0.0552225 0.0052513 0.0457883 0.0664650           
Psi s3 to1 g1 c2 a2 o4 t4 0.0552225 0.0052513 0.0457883 0.0664650           
Psi s3 to1 g1 c2 a3 o5 t5 0.0552225 0.0052513 0.0457883 0.0664650           
Psi s3 to1 g1 c3 a0 o3 t3 0.0552225 0.0052513 0.0457883 0.0664650           
Psi s3 to1 g1 c3 a1 o4 t4 0.0552225 0.0052513 0.0457883 0.0664650           
Psi s3 to1 g1 c3 a2 o5 t5 0.0552225 0.0052513 0.0457883 0.0664650           
Psi s3 to1 g1 c4 a0 o4 t4 0.0552225 0.0052513 0.0457883 0.0664650           
Psi s3 to1 g1 c4 a1 o5 t5 0.0552225 0.0052513 0.0457883 0.0664650           
Psi s3 to1 g1 c5 a0 o5 t5 0.0552225 0.0052513 0.0457883 0.0664650           
Psi s3 to2 g1 c1 a0 o1 t1 0.2817068 0.0098518 0.2628053 0.3014118           
Psi s3 to2 g1 c1 a1 o2 t2 0.2817068 0.0098518 0.2628053 0.3014118           
Psi s3 to2 g1 c1 a2 o3 t3 0.2817068 0.0098518 0.2628053 0.3014118           
Psi s3 to2 g1 c1 a3 o4 t4 0.2817068 0.0098518 0.2628053 0.3014118           
Psi s3 to2 g1 c1 a4 o5 t5 0.2817068 0.0098518 0.2628053 0.3014118           
Psi s3 to2 g1 c2 a0 o2 t2 0.2817068 0.0098518 0.2628053 0.3014118           
Psi s3 to2 g1 c2 a1 o3 t3 0.2817068 0.0098518 0.2628053 0.3014118           
Psi s3 to2 g1 c2 a2 o4 t4 0.2817068 0.0098518 0.2628053 0.3014118           
Psi s3 to2 g1 c2 a3 o5 t5 0.2817068 0.0098518 0.2628053 0.3014118           
Psi s3 to2 g1 c3 a0 o3 t3 0.2817068 0.0098518 0.2628053 0.3014118           
Psi s3 to2 g1 c3 a1 o4 t4 0.2817068 0.0098518 0.2628053 0.3014118           
Psi s3 to2 g1 c3 a2 o5 t5 0.2817068 0.0098518 0.2628053 0.3014118           
Psi s3 to2 g1 c4 a0 o4 t4 0.2817068 0.0098518 0.2628053 0.3014118           
Psi s3 to2 g1 c4 a1 o5 t5 0.2817068 0.0098518 0.2628053 0.3014118           
Psi s3 to2 g1 c5 a0 o5 t5 0.2817068 0.0098518 0.2628053 0.3014118           
```


---


```r
Psilist &lt;- get.real(phi.psi.p, "Psi", vcv = TRUE)
Psi.values = Psilist$estimates
top.psi = TransitionMatrix(Psi.values[Psi.values$time == 1, ], 
                           vcv.real = Psilist$vcv.real)
top.psi
```

```
$TransitionMat
           1         2           3
1 0.75307907 0.2416293 0.005291634
2 0.11752886 0.8607765 0.021694675
3 0.05522245 0.2817068 0.663070790

$se.TransitionMat
            1           2           3
1 0.006724581 0.006704850 0.001224924
2 0.003634296 0.003918255 0.001642781
3 0.005251281 0.009851788 0.010086287

$lcl.TransitionMat
           1         2           3
1 0.73966386 0.2287323 0.003360018
2 0.11059062 0.8529177 0.018698015
3 0.04578831 0.2628053 0.643025492

$ucl.TransitionMat
          1         2           3
1 0.7660217 0.2550131 0.008324427
2 0.1248413 0.8682802 0.025159286
3 0.0664650 0.3014118 0.682546177
```


---


```r
collect.models()
```

```
                                         model npar     AICc DeltaAICc
2 S(~stratum)p(~1)Psi(~-1 + stratum:tostratum)   10 73763.07   0.00000
1       S(~1)p(~1)Psi(~-1 + stratum:tostratum)    8 73778.36  15.29048
        weight Deviance
2 0.9995219131 2587.346
1 0.0004780869 2606.639
```






    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"ratio": "16:9",
"highlightStyle": "github",
"highlightLines": true,
"slideNumberFormat": ""
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
