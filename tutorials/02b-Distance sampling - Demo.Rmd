---
title: "Distance sampling Demo"
author: "Aur√©lien Besnard"
date: "last updated: `r Sys.Date()`"
output:
  xaringan::moon_reader:
    css: [default, "slides-theme.css"]
    lib_dir: libs
    nature:
      ratio: '16:9' 
      highlightStyle: github
      highlightLines: true
      slideNumberFormat: ''
      titleSlideClass: [center, middle]
---

```{r setup, include=FALSE, echo=FALSE, cache = FALSE}
options(htmltools.dir.version = FALSE)
knitr::opts_chunk$set(comment = "")
library(tidyverse)
theme_set(theme_light())
update_geom_defaults("point", list(size = 2)) 
```
<style type="text/css">pre {font-size: 18px}</style>

# Load Distance package

```{r}
library(Distance)
```

---
# Read the data (1)

An example of data provided by Eric Rexstad in Distance package

Line transect data of winter wrens in Scotland

```{r}
data(wren_lt)
```


---
# Explore the data (1)

```{r}
wren_lt
```

---
# Explore the data (2)

```{r}
dim(wren_lt) 
sum(is.na(wren_lt$distance))  # transect with no observations at all

```
---
# Explore the data (3)

```{r, eval=FALSE}
hist(wren_lt$distance, xlab="Distance (m)", main="Winter wren line transects")

```
---
# Explore the data (3)

```{r, echo=FALSE}
hist(wren_lt$distance, xlab="Distance (m)", 
     main="Winter wren line transects")

```
---
# Specify units 
Choose the units in which  density is to be reported

- Distance_units - units of measure for perpendicular/radial distances
- Effort_units - units of measure for effort (NULL for point transects)
- Area_units -units of measure for the study area.

```{r}
conversion.factor <- convert_units("meter", "kilometer","hectare")
```

---
# Fit a simple detection function model 

```{r}
wren.hn <- ds(data=wren_lt, key="hn", adjustment=NULL,
              convert.units=conversion.factor)
```
---
# Fit a simple detection function model 

```{r}
summary(wren.hn)
```

---
# Explore results (1)

```{r, eval=FALSE}
cutpoints <- c(0,5,10,15,20,30,40,50,65,80,100)
plot(wren.hn, breaks=cutpoints, main="Half normal model, 
     wren line transects")

```
---
# Explore results (1)

```{r, echo=FALSE}
cutpoints <- c(0,5,10,15,20,30,40,50,65,80,100)
plot(wren.hn, breaks=cutpoints, main="Half normal model, 
     wren line transects")

```
---
# Explore results (2)

```{r}
str(wren.hn)
```

---
# Get estimates - detection function

```{r}
wren.hn$ddf

```

---
# Get estimates - density 
```{r}
wren.hn$dht

```
---
# Fit some more models

```{r, eval=FALSE}
wren.unif.cos <- ds(wren_lt, key="unif", adjustment="cos",
                  convert.units=conversion.factor)
wren.hr.poly <- ds(wren_lt, key="hr", adjustment="poly", 
                  convert.units=conversion.factor)
```

```{r, echo=FALSE}
wren.unif.cos <- ds(wren_lt, key="unif", adjustment="cos",
                  convert.units=conversion.factor)
wren.hr.poly <- ds(wren_lt, key="hr", adjustment="poly", 
                  convert.units=conversion.factor)
```
---
# Compare these models

```{r}
AIC(wren.hn, wren.hr.poly, wren.unif.cos)
```

---
# GOF

.pull-left[
```{r}
z<-gof_ds(wren.hn)
```
]

.pull-right[
```{r echo=FALSE}
z
```
]
