<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Estimation of demographic parameters - tutorial</title>
    <meta charset="utf-8" />
    <meta name="author" content="Olivier Gimenez for the team" />
    <script src="libs/header-attrs/header-attrs.js"></script>
    <link href="libs/remark-css/default.css" rel="stylesheet" />
    <link rel="stylesheet" href="slides-theme.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, title-slide

# Estimation of demographic parameters - tutorial
### Olivier Gimenez for the team
### last updated: 2022-02-09

---




class: center, middle
background-size: cover

## Live demo #1: A simple CJS model

---
## Load RMark package


```r
library(RMark)
```

---
## Read in data (1)

Read in csv file:

```r
dipper_csv &lt;- read_csv("dat/dipper.csv")
```

---
## Read in data (2)


```r
dipper_csv
```

```
# A tibble: 294 × 9
   year_1981 year_1982 year_1983 year_1984 year_1985 year_1986 year_1987 sex  
       &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;
 1         1         1         1         1         1         1         0 M    
 2         1         1         1         1         1         0         0 F    
 3         1         1         1         1         0         0         0 M    
 4         1         1         1         1         0         0         0 F    
 5         1         1         0         1         1         1         0 F    
 6         1         1         0         0         0         0         0 M    
 7         1         1         0         0         0         0         0 M    
 8         1         1         0         0         0         0         0 M    
 9         1         1         0         0         0         0         0 M    
10         1         1         0         0         0         0         0 F    
# … with 284 more rows, and 1 more variable: wing_length &lt;dbl&gt;
```

---
## Convert to Mark format (1)

Build a data.frame with encounter histories, sex and (scaled) wing length:

```r
dipper &lt;- data.frame(ch = unite(dipper_csv %&gt;%
                                  select(year_1981:year_1987), 
                                col = "ch", 
                                sep = ""), 
                     sex = dipper_csv$sex,
                     wglength = scale(dipper_csv$wing_length))
```

---
## Convert to Mark format (2)

Inspect first lines:

```r
head(dipper)
```

```
       ch sex   wglength
1 1111110   M  0.7581335
2 1111100   F -0.8671152
3 1111000   M  0.5259551
4 1111000   F -1.5636504
5 1101110   F -1.3314720
6 1100000   M  1.2224903
```

---
## Fit model with parameters constant over time


```r
phi.p &lt;- mark(dipper)
```

```

Output summary for CJS model
Name : Phi(~1)p(~1) 

Npar :  2
-2lnL:  666.8377
AICc :  670.866

Beta
                 estimate        se       lcl       ucl
Phi:(Intercept) 0.2421484 0.1020127 0.0422034 0.4420933
p:(Intercept)   2.2262661 0.3251094 1.5890517 2.8634805


Real Parameter Phi
 
         1        2        3        4        5        6
1 0.560243 0.560243 0.560243 0.560243 0.560243 0.560243
2          0.560243 0.560243 0.560243 0.560243 0.560243
3                   0.560243 0.560243 0.560243 0.560243
4                            0.560243 0.560243 0.560243
5                                     0.560243 0.560243
6                                              0.560243


Real Parameter p
 
          2         3         4         5         6         7
1 0.9025835 0.9025835 0.9025835 0.9025835 0.9025835 0.9025835
2           0.9025835 0.9025835 0.9025835 0.9025835 0.9025835
3                     0.9025835 0.9025835 0.9025835 0.9025835
4                               0.9025835 0.9025835 0.9025835
5                                         0.9025835 0.9025835
6                                                   0.9025835
```

---
## Explore results (1)

We get a list with many components:

```r
str(phi.p, max.level = 0)
```

```
List of 25
 - attr(*, "class")= chr [1:2] "mark" "CJS"
```

---
## Explore results (2)

What are the components of this list?

```r
names(phi.p)
```

```
 [1] "data"             "model"            "title"            "model.name"      
 [5] "links"            "mixtures"         "call"             "parameters"      
 [9] "time.intervals"   "number.of.groups" "group.labels"     "nocc"            
[13] "begin.time"       "covariates"       "fixed"            "design.matrix"   
[17] "pims"             "design.data"      "strata.labels"    "mlogit.list"     
[21] "profile.int"      "simplify"         "model.parameters" "results"         
[25] "output"          
```

---
## Explore results (3)

Get parameters estimates:

```r
phi.p$results$real
```

```
                 estimate        se       lcl       ucl fixed note
Phi g1 c1 a0 t1 0.5602430 0.0251330 0.5105493 0.6087577           
p g1 c1 a1 t2   0.9025835 0.0285857 0.8304826 0.9460113           
```

---
class: center, middle
background-size: cover

## Variation around the CJS model

---
## Preliminaries

+ Process data (number of capture occasions, time intervals, groups):

```r
dipper.proc &lt;- process.data(data = dipper, groups = "sex")
```

--

+ Create design matrix with time and group structure:

```r
dipper.ddl &lt;- make.design.data(dipper.proc)
```

--

+ Define structure for survival and detection probabilities:

```r
phit &lt;- list(formula=~time) # time 
phi &lt;- list(formula=~1)     # constant
pt &lt;- list(formula=~time)   # time
p &lt;- list(formula=~1)       # constant
```

---
## Fit CJS model to dipper data


```r
phit.pt &lt;- mark(dipper.proc,
                dipper.ddl,
                model.parameters = list(Phi = phit, p = pt))
```

---


```

Output summary for CJS model
Name : Phi(~time)p(~time) 

Npar :  12  (unadjusted=11)
-2lnL:  656.9502
AICc :  681.7057  (unadjusted=679.58789)

Beta
                  estimate        se        lcl        ucl
Phi:(Intercept)  0.9354596 0.7685240 -0.5708474  2.4417667
Phi:time2       -1.1982791 0.8706716 -2.9047956  0.5082374
Phi:time3       -1.0228330 0.8049162 -2.6004687  0.5548026
Phi:time4       -0.4198624 0.8091501 -2.0057966  1.1660718
Phi:time5       -0.5361017 0.8031451 -2.1102661  1.0380626
Phi:time6        0.2481371 0.0000000  0.2481371  0.2481371
p:(Intercept)    0.8292805 0.7837351 -0.7068403  2.3654013
p:time3          1.6556278 1.2913803 -0.8754776  4.1867331
p:time4          1.5220942 1.0729140 -0.5808172  3.6250057
p:time5          1.3767432 0.9884809 -0.5606795  3.3141658
p:time6          1.7950916 1.0688768 -0.2999069  3.8900901
p:time7         -0.0147565 0.0000000 -0.0147565 -0.0147565


Real Parameter Phi
Group:sexF 
          1         2         3         4         5         6
1 0.7181816 0.4346707 0.4781705 0.6261177 0.5985334 0.7655939
2           0.4346707 0.4781705 0.6261177 0.5985334 0.7655939
3                     0.4781705 0.6261177 0.5985334 0.7655939
4                               0.6261177 0.5985334 0.7655939
5                                         0.5985334 0.7655939
6                                                   0.7655939

Group:sexM 
          1         2         3         4         5         6
1 0.7181816 0.4346707 0.4781705 0.6261177 0.5985334 0.7655939
2           0.4346707 0.4781705 0.6261177 0.5985334 0.7655939
3                     0.4781705 0.6261177 0.5985334 0.7655939
4                               0.6261177 0.5985334 0.7655939
5                                         0.5985334 0.7655939
6                                                   0.7655939


Real Parameter p
Group:sexF 
          2        3         4         5         6         7
1 0.6962028 0.923077 0.9130434 0.9007891 0.9324138 0.6930727
2           0.923077 0.9130434 0.9007891 0.9324138 0.6930727
3                    0.9130434 0.9007891 0.9324138 0.6930727
4                              0.9007891 0.9324138 0.6930727
5                                        0.9324138 0.6930727
6                                                  0.6930727

Group:sexM 
          2        3         4         5         6         7
1 0.6962028 0.923077 0.9130434 0.9007891 0.9324138 0.6930727
2           0.923077 0.9130434 0.9007891 0.9324138 0.6930727
3                    0.9130434 0.9007891 0.9324138 0.6930727
4                              0.9007891 0.9324138 0.6930727
5                                        0.9324138 0.6930727
6                                                  0.6930727
```

---


```r
phit.pt$results$real
```

```
                 estimate        se       lcl       ucl fixed note
Phi gF c1 a0 t1 0.7181816 0.1555468 0.3610413 0.9199573           
Phi gF c1 a1 t2 0.4346707 0.0688290 0.3075047 0.5710588           
Phi gF c1 a2 t3 0.4781705 0.0597091 0.3643839 0.5942686           
Phi gF c1 a3 t4 0.6261177 0.0592656 0.5048461 0.7333741           
Phi gF c1 a4 t5 0.5985334 0.0560517 0.4855434 0.7019411           
Phi gF c1 a5 t6 0.7655939 0.0000000 0.7655939 0.7655939           
p gF c1 a1 t2   0.6962028 0.1657635 0.3302974 0.9141506           
p gF c1 a2 t3   0.9230770 0.0728778 0.6161495 0.9889758           
p gF c1 a3 t4   0.9130434 0.0581758 0.7140648 0.9778505           
p gF c1 a4 t5   0.9007891 0.0538330 0.7360176 0.9672855           
p gF c1 a5 t6   0.9324138 0.0458025 0.7684926 0.9828579           
p gF c1 a6 t7   0.6930727 0.0000000 0.6930727 0.6930727           
```

---
## Fit model with time-varying survival and constant detection


```r
phit.p &lt;- mark(dipper.proc,
                dipper.ddl,
                model.parameters = list(Phi = phit, p = p))
```

---


```

Output summary for CJS model
Name : Phi(~time)p(~1) 

Npar :  7
-2lnL:  659.7301
AICc :  673.998

Beta
                  estimate        se        lcl       ucl
Phi:(Intercept)  0.5143909 0.4767789 -0.4200957 1.4488775
Phi:time2       -0.6981410 0.5537184 -1.7834291 0.3871471
Phi:time3       -0.6009362 0.5300984 -1.6399291 0.4380567
Phi:time4       -0.0061059 0.5334596 -1.0516868 1.0394750
Phi:time5       -0.0757115 0.5276488 -1.1099031 0.9584801
Phi:time6       -0.1780634 0.5265637 -1.2101283 0.8540016
p:(Intercept)    2.2203956 0.3288850  1.5757810 2.8650101


Real Parameter Phi
Group:sexF 
          1         2         3         4         5         6
1 0.6258352 0.4541913 0.4783772 0.6244043 0.6079443 0.5832982
2           0.4541913 0.4783772 0.6244043 0.6079443 0.5832982
3                     0.4783772 0.6244043 0.6079443 0.5832982
4                               0.6244043 0.6079443 0.5832982
5                                         0.6079443 0.5832982
6                                                   0.5832982

Group:sexM 
          1         2         3         4         5         6
1 0.6258352 0.4541913 0.4783772 0.6244043 0.6079443 0.5832982
2           0.4541913 0.4783772 0.6244043 0.6079443 0.5832982
3                     0.4783772 0.6244043 0.6079443 0.5832982
4                               0.6244043 0.6079443 0.5832982
5                                         0.6079443 0.5832982
6                                                   0.5832982


Real Parameter p
Group:sexF 
          2         3         4         5         6         7
1 0.9020661 0.9020661 0.9020661 0.9020661 0.9020661 0.9020661
2           0.9020661 0.9020661 0.9020661 0.9020661 0.9020661
3                     0.9020661 0.9020661 0.9020661 0.9020661
4                               0.9020661 0.9020661 0.9020661
5                                         0.9020661 0.9020661
6                                                   0.9020661

Group:sexM 
          2         3         4         5         6         7
1 0.9020661 0.9020661 0.9020661 0.9020661 0.9020661 0.9020661
2           0.9020661 0.9020661 0.9020661 0.9020661 0.9020661
3                     0.9020661 0.9020661 0.9020661 0.9020661
4                               0.9020661 0.9020661 0.9020661
5                                         0.9020661 0.9020661
6                                                   0.9020661
```

---
## Fit model with constant survival and time-varying detection


```r
phi.pt &lt;- mark(dipper.proc,
                dipper.ddl,
                model.parameters = list(Phi = phi, p = pt))
```

---


```

Output summary for CJS model
Name : Phi(~1)p(~time) 

Npar :  7
-2lnL:  664.4802
AICc :  678.7481

Beta
                 estimate        se        lcl       ucl
Phi:(Intercept) 0.2131639 0.1121134 -0.0065783 0.4329062
p:(Intercept)   1.2955231 0.7437187 -0.1621655 2.7532118
p:time3         0.8005301 1.1635420 -1.4800123 3.0810725
p:time4         0.6512792 1.0018510 -1.3123488 2.6149072
p:time5         0.9977297 0.9454427 -0.8553381 2.8507975
p:time6         1.4658908 1.0303949 -0.5536832 3.4854649
p:time7         1.9900841 3.0642144 -4.0157763 7.9959445


Real Parameter Phi
Group:sexF 
          1         2         3         4         5         6
1 0.5530901 0.5530901 0.5530901 0.5530901 0.5530901 0.5530901
2           0.5530901 0.5530901 0.5530901 0.5530901 0.5530901
3                     0.5530901 0.5530901 0.5530901 0.5530901
4                               0.5530901 0.5530901 0.5530901
5                                         0.5530901 0.5530901
6                                                   0.5530901

Group:sexM 
          1         2         3         4         5         6
1 0.5530901 0.5530901 0.5530901 0.5530901 0.5530901 0.5530901
2           0.5530901 0.5530901 0.5530901 0.5530901 0.5530901
3                     0.5530901 0.5530901 0.5530901 0.5530901
4                               0.5530901 0.5530901 0.5530901
5                                         0.5530901 0.5530901
6                                                   0.5530901


Real Parameter p
Group:sexF 
          2        3         4         5         6         7
1 0.7850806 0.890519 0.8750975 0.9083167 0.9405547 0.9639317
2           0.890519 0.8750975 0.9083167 0.9405547 0.9639317
3                    0.8750975 0.9083167 0.9405547 0.9639317
4                              0.9083167 0.9405547 0.9639317
5                                        0.9405547 0.9639317
6                                                  0.9639317

Group:sexM 
          2        3         4         5         6         7
1 0.7850806 0.890519 0.8750975 0.9083167 0.9405547 0.9639317
2           0.890519 0.8750975 0.9083167 0.9405547 0.9639317
3                    0.8750975 0.9083167 0.9405547 0.9639317
4                              0.9083167 0.9405547 0.9639317
5                                        0.9405547 0.9639317
6                                                  0.9639317
```

---
## Model ranking with AIC 


```r
collect.models()
```

```
               model npar     AICc DeltaAICc      weight Deviance
1       Phi(~1)p(~1)    2 670.8660  0.000000 0.811204642 58.15788
3    Phi(~time)p(~1)    7 673.9980  3.132004 0.169443317 77.25297
2    Phi(~1)p(~time)    7 678.7481  7.882084 0.015760053 82.00306
4 Phi(~time)p(~time)   12 681.7057 10.839629 0.003591988 74.47310
```

+ Best model has constant parameters

---
class: center, middle
background-size: cover

## Live demo #2: Group effect

---
## Define sex-specific survival


```r
phisex &lt;- list(formula=~sex)
```

---
## Fit model with sex-specific survival, and constant detection


```r
phisex.p &lt;- mark(dipper.proc,
                 dipper.ddl,
                 model.parameters = list(Phi = phisex, p = p))
```

---


```

Output summary for CJS model
Name : Phi(~sex)p(~1) 

Npar :  3
-2lnL:  666.6762
AICc :  672.7331

Beta
                 estimate        se        lcl       ucl
Phi:(Intercept) 0.2036416 0.1397215 -0.0702125 0.4774957
Phi:sexM        0.0792855 0.1973411 -0.3075030 0.4660741
p:(Intercept)   2.2274856 0.3251811  1.5901306 2.8648406


Real Parameter Phi
Group:sexF 
          1         2         3         4         5         6
1 0.5507352 0.5507352 0.5507352 0.5507352 0.5507352 0.5507352
2           0.5507352 0.5507352 0.5507352 0.5507352 0.5507352
3                     0.5507352 0.5507352 0.5507352 0.5507352
4                               0.5507352 0.5507352 0.5507352
5                                         0.5507352 0.5507352
6                                                   0.5507352

Group:sexM 
          1         2         3         4         5         6
1 0.5702637 0.5702637 0.5702637 0.5702637 0.5702637 0.5702637
2           0.5702637 0.5702637 0.5702637 0.5702637 0.5702637
3                     0.5702637 0.5702637 0.5702637 0.5702637
4                               0.5702637 0.5702637 0.5702637
5                                         0.5702637 0.5702637
6                                                   0.5702637


Real Parameter p
Group:sexF 
          2         3         4         5         6         7
1 0.9026907 0.9026907 0.9026907 0.9026907 0.9026907 0.9026907
2           0.9026907 0.9026907 0.9026907 0.9026907 0.9026907
3                     0.9026907 0.9026907 0.9026907 0.9026907
4                               0.9026907 0.9026907 0.9026907
5                                         0.9026907 0.9026907
6                                                   0.9026907

Group:sexM 
          2         3         4         5         6         7
1 0.9026907 0.9026907 0.9026907 0.9026907 0.9026907 0.9026907
2           0.9026907 0.9026907 0.9026907 0.9026907 0.9026907
3                     0.9026907 0.9026907 0.9026907 0.9026907
4                               0.9026907 0.9026907 0.9026907
5                                         0.9026907 0.9026907
6                                                   0.9026907
```

---
## Parameter estimates (1)

+ On the logit scale:

```r
phisex.p$results$beta
```

```
                 estimate        se        lcl       ucl
Phi:(Intercept) 0.2036416 0.1397215 -0.0702125 0.4774957
Phi:sexM        0.0792855 0.1973411 -0.3075030 0.4660741
p:(Intercept)   2.2274856 0.3251811  1.5901306 2.8648406
```

---
## Parameter estimates (2)

+ Female survival:

```r
logitphiF &lt;- phisex.p$results$beta[1,1]
plogis(logitphiF)
```

```
[1] 0.5507352
```

--

Male survival:

```r
logitphiM &lt;- logitphiF + phisex.p$results$beta[2,1]
plogis(logitphiM)
```

```
[1] 0.5702637
```

---
## Parameter estimates (3)

All at once:

```r
phisex.p$results$real
```

```
                 estimate        se       lcl       ucl fixed note
Phi gF c1 a0 t1 0.5507352 0.0345707 0.4824541 0.6171563           
Phi gM c1 a0 t1 0.5702637 0.0353294 0.5000912 0.6377218           
p gF c1 a1 t2   0.9026907 0.0285640 0.8306345 0.9460808           
```


---
## Model ranking with AIC 


```r
collect.models()
```

```
               model npar     AICc DeltaAICc      weight Deviance
1       Phi(~1)p(~1)    2 670.8660  0.000000 0.615043503 58.15788
3     Phi(~sex)p(~1)    3 672.7331  1.867043 0.241814615 84.19909
4    Phi(~time)p(~1)    7 673.9980  3.132004 0.128469447 77.25297
2    Phi(~1)p(~time)    7 678.7481  7.882084 0.011949042 82.00306
5 Phi(~time)p(~time)   12 681.7057 10.839629 0.002723393 74.47310
```

---
## Model with additive effect of sex and time on survival and constant detection


```r
phisexpt &lt;- list(formula=~sex+time)

phisexpt.p &lt;- mark(dipper.proc,
                   dipper.ddl,
                   model.parameters = list(Phi = phisexpt, 
                                           p = p))
```

---


```

Output summary for CJS model
Name : Phi(~sex + time)p(~1) 

Npar :  8
-2lnL:  659.6491
AICc :  675.9945

Beta
                  estimate        se        lcl       ucl
Phi:(Intercept)  0.4829419 0.4891844 -0.4758595 1.4417433
Phi:sexM         0.0568891 0.1999509 -0.3350147 0.4487928
Phi:time2       -0.6915563 0.5541019 -1.7775961 0.3944835
Phi:time3       -0.5961723 0.5302478 -1.6354581 0.4431135
Phi:time4       -0.0022596 0.5335348 -1.0479879 1.0434687
Phi:time5       -0.0729154 0.5276450 -1.1070996 0.9612687
Phi:time6       -0.1754296 0.5265102 -1.2073897 0.8565304
p:(Intercept)    2.2215639 0.3289059  1.5769083 2.8662195


Real Parameter Phi
Group:sexF 
          1         2         3        4         5         6
1 0.6184423 0.4480347 0.4717226 0.617909 0.6010942 0.5762779
2           0.4480347 0.4717226 0.617909 0.6010942 0.5762779
3                     0.4717226 0.617909 0.6010942 0.5762779
4                               0.617909 0.6010942 0.5762779
5                                        0.6010942 0.5762779
6                                                  0.5762779

Group:sexM 
          1         2         3         4         5         6
1 0.6317731 0.4621413 0.4859184 0.6312473 0.6146534 0.5901055
2           0.4621413 0.4859184 0.6312473 0.6146534 0.5901055
3                     0.4859184 0.6312473 0.6146534 0.5901055
4                               0.6312473 0.6146534 0.5901055
5                                         0.6146534 0.5901055
6                                                   0.5901055


Real Parameter p
Group:sexF 
          2         3         4         5         6         7
1 0.9021693 0.9021693 0.9021693 0.9021693 0.9021693 0.9021693
2           0.9021693 0.9021693 0.9021693 0.9021693 0.9021693
3                     0.9021693 0.9021693 0.9021693 0.9021693
4                               0.9021693 0.9021693 0.9021693
5                                         0.9021693 0.9021693
6                                                   0.9021693

Group:sexM 
          2         3         4         5         6         7
1 0.9021693 0.9021693 0.9021693 0.9021693 0.9021693 0.9021693
2           0.9021693 0.9021693 0.9021693 0.9021693 0.9021693
3                     0.9021693 0.9021693 0.9021693 0.9021693
4                               0.9021693 0.9021693 0.9021693
5                                         0.9021693 0.9021693
6                                                   0.9021693
```

---


```r
phisexpt.p$results$real
```

```
                 estimate        se       lcl       ucl fixed note
Phi gF c1 a0 t1 0.6184423 0.1154335 0.3832303 0.8087245           
Phi gF c1 a1 t2 0.4480347 0.0699014 0.3180765 0.5855009           
Phi gF c1 a2 t3 0.4717226 0.0628891 0.3525469 0.5942112           
Phi gF c1 a3 t4 0.6179090 0.0617793 0.4919536 0.7297891           
Phi gF c1 a4 t5 0.6010942 0.0601805 0.4795367 0.7113504           
Phi gF c1 a5 t6 0.5762779 0.0624635 0.4516836 0.6918740           
Phi gM c1 a0 t1 0.6317731 0.1128461 0.3986920 0.8161653           
Phi gM c1 a1 t2 0.4621413 0.0724222 0.3267790 0.6033250           
Phi gM c1 a2 t3 0.4859184 0.0642372 0.3634640 0.6100871           
Phi gM c1 a3 t4 0.6312473 0.0615073 0.5049170 0.7418247           
Phi gM c1 a4 t5 0.6146534 0.0593749 0.4938955 0.7227713           
Phi gM c1 a5 t6 0.5901055 0.0617602 0.4660395 0.7036738           
p gF c1 a1 t2   0.9021693 0.0290292 0.8287662 0.9461511           
```

---

&lt;img src="survival-tutorial_files/figure-html/unnamed-chunk-32-1.svg" style="display: block; margin: auto;" /&gt;


---
## Model ranking with AIC 


```r
collect.models()
```

```
                  model npar     AICc DeltaAICc      weight Deviance
1          Phi(~1)p(~1)    2 670.8660  0.000000 0.587240217 58.15788
3        Phi(~sex)p(~1)    3 672.7331  1.867043 0.230883290 84.19909
5       Phi(~time)p(~1)    7 673.9980  3.132004 0.122661934 77.25297
4 Phi(~sex + time)p(~1)    8 675.9945  5.128435 0.045205397 77.17203
2       Phi(~1)p(~time)    7 678.7481  7.882084 0.011408881 82.00306
6    Phi(~time)p(~time)   12 681.7057 10.839629 0.002600281 74.47310
```


---
class: center, middle
background-size: cover

## Live demo #2: Continuous individual covariate


---
## Fit model with linear effect of wing length on survival 


```r
phiwl &lt;- list(formula=~wglength)
```

--


```r
phiwl.p &lt;- mark(dipper.proc,
                dipper.ddl,
                model.parameters = list(Phi = phiwl, 
                                        p = p))
```

---
## Parameter estimates (1)


```

Output summary for CJS model
Name : Phi(~wglength)p(~1) 

Npar :  3
-2lnL:  666.8
AICc :  672.8569

Beta
                  estimate        se        lcl       ucl
Phi:(Intercept)  0.2418000 0.1020371  0.0418072 0.4417928
Phi:wglength    -0.0182028 0.0938329 -0.2021153 0.1657096
p:(Intercept)    2.2259839 0.3250863  1.5888149 2.8631530


Real Parameter Phi
Group:sexF 
          1         2         3         4         5         6
1 0.5601572 0.5601572 0.5601572 0.5601572 0.5601572 0.5601572
2           0.5601572 0.5601572 0.5601572 0.5601572 0.5601572
3                     0.5601572 0.5601572 0.5601572 0.5601572
4                               0.5601572 0.5601572 0.5601572
5                                         0.5601572 0.5601572
6                                                   0.5601572

Group:sexM 
          1         2         3         4         5         6
1 0.5601572 0.5601572 0.5601572 0.5601572 0.5601572 0.5601572
2           0.5601572 0.5601572 0.5601572 0.5601572 0.5601572
3                     0.5601572 0.5601572 0.5601572 0.5601572
4                               0.5601572 0.5601572 0.5601572
5                                         0.5601572 0.5601572
6                                                   0.5601572


Real Parameter p
Group:sexF 
          2         3         4         5         6         7
1 0.9025587 0.9025587 0.9025587 0.9025587 0.9025587 0.9025587
2           0.9025587 0.9025587 0.9025587 0.9025587 0.9025587
3                     0.9025587 0.9025587 0.9025587 0.9025587
4                               0.9025587 0.9025587 0.9025587
5                                         0.9025587 0.9025587
6                                                   0.9025587

Group:sexM 
          2         3         4         5         6         7
1 0.9025587 0.9025587 0.9025587 0.9025587 0.9025587 0.9025587
2           0.9025587 0.9025587 0.9025587 0.9025587 0.9025587
3                     0.9025587 0.9025587 0.9025587 0.9025587
4                               0.9025587 0.9025587 0.9025587
5                                         0.9025587 0.9025587
6                                                   0.9025587
```

---
## Parameter estimates (2)


```r
phiwl.p$results$beta
```

```
                  estimate        se        lcl       ucl
Phi:(Intercept)  0.2418000 0.1020371  0.0418072 0.4417928
Phi:wglength    -0.0182028 0.0938329 -0.2021153 0.1657096
p:(Intercept)    2.2259839 0.3250863  1.5888149 2.8631530
```

---
## Graphical representation (1)


```r
# standardize wing length
scaled_wl &lt;- scale(dipper_csv$wing_length)
# build a grid of 100 values between min and max of wing length
grid_wl &lt;- seq(min(scaled_wl), max(scaled_wl), length = 100)
# predict survival on logit scale
logit_predicted_survival &lt;- phiwl.p$results$beta[1,1] + 
                    phiwl.p$results$beta[2,1] * grid_wl
# back-transform to get predicted survival
predicted_survival &lt;- plogis(logit_predicted_survival)
# create data.frame
df &lt;- data.frame(winglength = grid_wl,
                 survival = predicted_survival)
```

---
## Graphical representation (2)


```r
# visualise
df %&gt;% 
  ggplot() +
  aes(x = winglength, y = survival) + 
  geom_line()
```

---

&lt;img src="survival-tutorial_files/figure-html/unnamed-chunk-40-1.svg" style="display: block; margin: auto;" /&gt;

---
## Quadratic relationship


```r
# square standardised covariate and add it to dipper data
dipper$wglengthsq &lt;- scale(dipper_csv$wing_length)^2
# process data
dipper.proc &lt;- process.data(data = dipper, 
                            groups = ("sex"))
# build design matrices
dipper.ddl &lt;- make.design.data(dipper.proc)
```


---
## Fit model with quadratic effect of wing length on survival


```r
phiwl2 &lt;- list(formula=~wglength + wglengthsq)
```

--


```r
phiwl2.p &lt;- mark(dipper.proc,
                 dipper.ddl,
                 model.parameters = list(Phi = phiwl2, p = p))
```

---


```

Output summary for CJS model
Name : Phi(~wglength + wglengthsq)p(~1) 

Npar :  4
-2lnL:  663.6145
AICc :  671.7095

Beta
                  estimate        se        lcl       ucl
Phi:(Intercept)  0.0165961 0.1618091 -0.3005498 0.3337419
Phi:wglength    -0.0255470 0.0955639 -0.2128523 0.1617582
Phi:wglengthsq   0.2058717 0.1165635 -0.0225928 0.4343361
p:(Intercept)    2.2313326 0.3250768  1.5941821 2.8684832


Real Parameter Phi
Group:sexF 
          1         2         3         4         5         6
1 0.5552158 0.5552158 0.5552158 0.5552158 0.5552158 0.5552158
2           0.5552158 0.5552158 0.5552158 0.5552158 0.5552158
3                     0.5552158 0.5552158 0.5552158 0.5552158
4                               0.5552158 0.5552158 0.5552158
5                                         0.5552158 0.5552158
6                                                   0.5552158

Group:sexM 
          1         2         3         4         5         6
1 0.5552158 0.5552158 0.5552158 0.5552158 0.5552158 0.5552158
2           0.5552158 0.5552158 0.5552158 0.5552158 0.5552158
3                     0.5552158 0.5552158 0.5552158 0.5552158
4                               0.5552158 0.5552158 0.5552158
5                                         0.5552158 0.5552158
6                                                   0.5552158


Real Parameter p
Group:sexF 
          2         3         4         5         6         7
1 0.9030281 0.9030281 0.9030281 0.9030281 0.9030281 0.9030281
2           0.9030281 0.9030281 0.9030281 0.9030281 0.9030281
3                     0.9030281 0.9030281 0.9030281 0.9030281
4                               0.9030281 0.9030281 0.9030281
5                                         0.9030281 0.9030281
6                                                   0.9030281

Group:sexM 
          2         3         4         5         6         7
1 0.9030281 0.9030281 0.9030281 0.9030281 0.9030281 0.9030281
2           0.9030281 0.9030281 0.9030281 0.9030281 0.9030281
3                     0.9030281 0.9030281 0.9030281 0.9030281
4                               0.9030281 0.9030281 0.9030281
5                                         0.9030281 0.9030281
6                                                   0.9030281
```

---


```r
phiwl2.p$results$beta
```

```
                  estimate        se        lcl       ucl
Phi:(Intercept)  0.0165961 0.1618091 -0.3005498 0.3337419
Phi:wglength    -0.0255470 0.0955639 -0.2128523 0.1617582
Phi:wglengthsq   0.2058717 0.1165635 -0.0225928 0.4343361
p:(Intercept)    2.2313326 0.3250768  1.5941821 2.8684832
```


---

&lt;img src="survival-tutorial_files/figure-html/unnamed-chunk-46-1.svg" style="display: block; margin: auto;" /&gt;

---
## Model ranking with AIC


```r
collect.models()
```

```
                             model npar     AICc  DeltaAICc      weight
1                     Phi(~1)p(~1)    2 670.8660  0.0000000 0.366521074
8 Phi(~wglength + wglengthsq)p(~1)    4 671.7095  0.8434531 0.240406077
3                   Phi(~sex)p(~1)    3 672.7331  1.8670432 0.144103876
7              Phi(~wglength)p(~1)    3 672.8569  1.9908732 0.135452280
5                  Phi(~time)p(~1)    7 673.9980  3.1320038 0.076558421
4            Phi(~sex + time)p(~1)    8 675.9945  5.1284349 0.028214571
2                  Phi(~1)p(~time)    7 678.7481  7.8820838 0.007120758
6               Phi(~time)p(~time)   12 681.7057 10.8396291 0.001622943
   Deviance
1  58.15788
8 663.61447
3  84.19909
7 666.80003
5  77.25297
4  77.17203
2  82.00306
6  74.47310
```

---
class: center, middle
background-size: cover

## Live demo #3: Environmental covariate

---
## Flood effect on survival?

+ A flood took place toward the end of the second survival interval and continue into the beginning of the third survival interval

+ Question is whether survival was lower in the two flood years

---
## Explore further model structure

```r
head(dipper.ddl$Phi)
```

```
  par.index model.index group cohort age time occ.cohort Cohort Age Time sex
1         1           1     F      1   0    1          1      0   0    0   F
2         2           2     F      1   1    2          1      0   1    1   F
3         3           3     F      1   2    3          1      0   2    2   F
4         4           4     F      1   3    4          1      0   3    3   F
5         5           5     F      1   4    5          1      0   4    4   F
6         6           6     F      1   5    6          1      0   5    5   F
```

---
## Create dummy Flood variable


```r
dipper.ddl$Phi$Flood &lt;- 0
head(dipper.ddl$Phi)
```

```
  par.index model.index group cohort age time occ.cohort Cohort Age Time sex
1         1           1     F      1   0    1          1      0   0    0   F
2         2           2     F      1   1    2          1      0   1    1   F
3         3           3     F      1   2    3          1      0   2    2   F
4         4           4     F      1   3    4          1      0   3    3   F
5         5           5     F      1   4    5          1      0   4    4   F
6         6           6     F      1   5    6          1      0   5    5   F
  Flood
1     0
2     0
3     0
4     0
5     0
6     0
```

---
## Add flood effect


```r
dipper.ddl$Phi$Flood[dipper.ddl$Phi$time==2 | 
                       dipper.ddl$Phi$time==3] &lt;- 1
head(dipper.ddl$Phi)
```

```
  par.index model.index group cohort age time occ.cohort Cohort Age Time sex
1         1           1     F      1   0    1          1      0   0    0   F
2         2           2     F      1   1    2          1      0   1    1   F
3         3           3     F      1   2    3          1      0   2    2   F
4         4           4     F      1   3    4          1      0   3    3   F
5         5           5     F      1   4    5          1      0   4    4   F
6         6           6     F      1   5    6          1      0   5    5   F
  Flood
1     0
2     1
3     1
4     0
5     0
6     0
```

---
## Fit model with flood effect


```r
phiFlood &lt;- list(formula=~Flood)
```

--


```r
phiFlood.p &lt;- mark(dipper.proc,
                   dipper.ddl,
                   model.parameters = list(Phi = phiFlood, 
                                           p = p))
```

---


```

Output summary for CJS model
Name : Phi(~Flood)p(~1) 

Npar :  3
-2lnL:  660.1028
AICc :  666.1597

Beta
                  estimate        se        lcl        ucl
Phi:(Intercept)  0.4351207 0.1297482  0.1808141  0.6894272
Phi:Flood       -0.5599739 0.2163758 -0.9840705 -0.1358773
p:(Intercept)    2.1948812 0.3246089  1.5586478  2.8311146


Real Parameter Phi
Group:sexF 
          1         2         3         4         5         6
1 0.6070958 0.4688272 0.4688272 0.6070958 0.6070958 0.6070958
2           0.4688272 0.4688272 0.6070958 0.6070958 0.6070958
3                     0.4688272 0.6070958 0.6070958 0.6070958
4                               0.6070958 0.6070958 0.6070958
5                                         0.6070958 0.6070958
6                                                   0.6070958

Group:sexM 
          1         2         3         4         5         6
1 0.6070958 0.4688272 0.4688272 0.6070958 0.6070958 0.6070958
2           0.4688272 0.4688272 0.6070958 0.6070958 0.6070958
3                     0.4688272 0.6070958 0.6070958 0.6070958
4                               0.6070958 0.6070958 0.6070958
5                                         0.6070958 0.6070958
6                                                   0.6070958


Real Parameter p
Group:sexF 
          2         3         4         5         6         7
1 0.8997889 0.8997889 0.8997889 0.8997889 0.8997889 0.8997889
2           0.8997889 0.8997889 0.8997889 0.8997889 0.8997889
3                     0.8997889 0.8997889 0.8997889 0.8997889
4                               0.8997889 0.8997889 0.8997889
5                                         0.8997889 0.8997889
6                                                   0.8997889

Group:sexM 
          2         3         4         5         6         7
1 0.8997889 0.8997889 0.8997889 0.8997889 0.8997889 0.8997889
2           0.8997889 0.8997889 0.8997889 0.8997889 0.8997889
3                     0.8997889 0.8997889 0.8997889 0.8997889
4                               0.8997889 0.8997889 0.8997889
5                                         0.8997889 0.8997889
6                                                   0.8997889
```

---


```r
phiFlood.p$results$real
```

```
                 estimate        se       lcl       ucl fixed note
Phi gF c1 a0 t1 0.6070958 0.0309489 0.5450808 0.6658395           
Phi gF c1 a1 t2 0.4688272 0.0432355 0.3857667 0.5536516           
p gF c1 a1 t2   0.8997889 0.0292696 0.8261592 0.9443342           
```

+ Clearly, survival in flood years was much lower than survival in non-flood years

---
## Model ranking with AIC


```r
collect.models()
```

```
                             model npar     AICc DeltaAICc       weight
3                 Phi(~Flood)p(~1)    3 666.1596  0.000000 0.7940469108
1                     Phi(~1)p(~1)    2 670.8660  4.706387 0.0754861475
9 Phi(~wglength + wglengthsq)p(~1)    4 671.7095  5.549840 0.0495123742
4                   Phi(~sex)p(~1)    3 672.7331  6.573430 0.0296786384
8              Phi(~wglength)p(~1)    3 672.8569  6.697260 0.0278968155
6                  Phi(~time)p(~1)    7 673.9980  7.838391 0.0157674434
5            Phi(~sex + time)p(~1)    8 675.9945  9.834822 0.0058108781
2                  Phi(~1)p(~time)    7 678.7481 12.588471 0.0014665420
7               Phi(~time)p(~time)   12 681.7057 15.546016 0.0003342502
   Deviance
3  77.62566
1  58.15788
9 663.61447
4  84.19909
8 666.80003
6  77.25297
5  77.17203
2  82.00306
7  74.47310
```


---
class: center, middle
background-size: cover

## Live demo #4: Age in capture-recapture models

---
## Build and fit a model with age-dependent survival


```r
phi.age &lt;- list(formula =~ age) # already coded in RMark
```

--


```r
phiage.p &lt;- mark(dipper.proc,
                 dipper.ddl,
                 model.parameters = list(Phi = phi.age, 
                                         p = p))
```

---


```

Output summary for CJS model
Name : Phi(~age)p(~1) 

Npar :  7  (unadjusted=6)
-2lnL:  662.8206
AICc :  677.0885  (unadjusted=675.02107)

Beta
                   estimate           se           lcl          ucl
Phi:(Intercept)   0.2052280    0.1393355    -0.0678695    0.4783255
Phi:age1          0.0214757    0.2537616    -0.4758969    0.5188484
Phi:age2          0.3587532    0.3691002    -0.3646832    1.0821897
Phi:age3         -0.0576709    0.5381903    -1.1125239    0.9971820
Phi:age4          0.2395466    0.8866447    -1.4982771    1.9773702
Phi:age5        -16.5713710 2553.1310000 -5020.7083000 4987.5655000
p:(Intercept)     2.2552270    0.3288433     1.6106941    2.8997599


Real Parameter Phi
Group:sexF 
          1         2         3         4         5            6
1 0.5511277 0.5564344 0.6373732 0.5368225 0.6093961 7.803231e-08
2           0.5511277 0.5564344 0.6373732 0.5368225 6.093961e-01
3                     0.5511277 0.5564344 0.6373732 5.368225e-01
4                               0.5511277 0.5564344 6.373732e-01
5                                         0.5511277 5.564344e-01
6                                                   5.511277e-01

Group:sexM 
          1         2         3         4         5            6
1 0.5511277 0.5564344 0.6373732 0.5368225 0.6093961 7.803231e-08
2           0.5511277 0.5564344 0.6373732 0.5368225 6.093961e-01
3                     0.5511277 0.5564344 0.6373732 5.368225e-01
4                               0.5511277 0.5564344 6.373732e-01
5                                         0.5511277 5.564344e-01
6                                                   5.511277e-01


Real Parameter p
Group:sexF 
          2         3         4         5         6         7
1 0.9051004 0.9051004 0.9051004 0.9051004 0.9051004 0.9051004
2           0.9051004 0.9051004 0.9051004 0.9051004 0.9051004
3                     0.9051004 0.9051004 0.9051004 0.9051004
4                               0.9051004 0.9051004 0.9051004
5                                         0.9051004 0.9051004
6                                                   0.9051004

Group:sexM 
          2         3         4         5         6         7
1 0.9051004 0.9051004 0.9051004 0.9051004 0.9051004 0.9051004
2           0.9051004 0.9051004 0.9051004 0.9051004 0.9051004
3                     0.9051004 0.9051004 0.9051004 0.9051004
4                               0.9051004 0.9051004 0.9051004
5                                         0.9051004 0.9051004
6                                                   0.9051004
```


---
## Parameter estimates


```r
phiage.p$results$real
```

```
                    estimate           se           lcl       ucl fixed note
Phi gF c1 a0 t1 5.511277e-01 0.0344696000  4.830391e-01 0.6173524           
Phi gF c1 a1 t2 5.564344e-01 0.0502658000  4.569903e-01 0.6515530           
Phi gF c1 a2 t3 6.373732e-01 0.0794809000  4.725210e-01 0.7752138           
Phi gF c1 a3 t4 5.368225e-01 0.1293735000  2.947838e-01 0.7626704           
Phi gF c1 a4 t5 6.093961e-01 0.2089614000  2.182577e-01 0.8970989           
Phi gF c1 a5 t6 7.803231e-08 0.0001992267 4.340691e-316 1.0000000           
p gF c1 a1 t2   9.051004e-01 0.0282455000  8.335077e-01 0.9478346           
```

---
## What if we'd like only 2 age classes? 

+ Create a (0, 1+) age variable:

```r
dipper.ddl &lt;- add.design.data(dipper.proc,
                              dipper.ddl, 
                              "Phi",
                              type = "age",
                              bins = c(0, 1, 7), # (0, 1+)
                              name = "ageclass", # var name
                              right = FALSE)
```

---
## Fit model with 2 age classes on survival


```r
phi.age2 &lt;- list(formula=~ageclass) # age effect on survival
```

--


```r
phiage2.p &lt;- mark(dipper.proc,
                  dipper.ddl,
                  model.parameters = list(Phi = phi.age2, 
                                          p = p))
```

---


```

Output summary for CJS model
Name : Phi(~ageclass)p(~1) 

Npar :  3
-2lnL:  666.6804
AICc :  672.7373

Beta
                   estimate        se        lcl       ucl
Phi:(Intercept)   0.2041823 0.1390053 -0.0682681 0.4766326
Phi:ageclass[1,7] 0.0841951 0.2119782 -0.3312822 0.4996725
p:(Intercept)     2.2456919 0.3285356  1.6017622 2.8896216


Real Parameter Phi
Group:sexF 
         1         2         3         4         5         6
1 0.550869 0.5715988 0.5715988 0.5715988 0.5715988 0.5715988
2          0.5508690 0.5715988 0.5715988 0.5715988 0.5715988
3                    0.5508690 0.5715988 0.5715988 0.5715988
4                              0.5508690 0.5715988 0.5715988
5                                        0.5508690 0.5715988
6                                                  0.5508690

Group:sexM 
         1         2         3         4         5         6
1 0.550869 0.5715988 0.5715988 0.5715988 0.5715988 0.5715988
2          0.5508690 0.5715988 0.5715988 0.5715988 0.5715988
3                    0.5508690 0.5715988 0.5715988 0.5715988
4                              0.5508690 0.5715988 0.5715988
5                                        0.5508690 0.5715988
6                                                  0.5508690


Real Parameter p
Group:sexF 
          2         3         4         5         6         7
1 0.9042783 0.9042783 0.9042783 0.9042783 0.9042783 0.9042783
2           0.9042783 0.9042783 0.9042783 0.9042783 0.9042783
3                     0.9042783 0.9042783 0.9042783 0.9042783
4                               0.9042783 0.9042783 0.9042783
5                                         0.9042783 0.9042783
6                                                   0.9042783

Group:sexM 
          2         3         4         5         6         7
1 0.9042783 0.9042783 0.9042783 0.9042783 0.9042783 0.9042783
2           0.9042783 0.9042783 0.9042783 0.9042783 0.9042783
3                     0.9042783 0.9042783 0.9042783 0.9042783
4                               0.9042783 0.9042783 0.9042783
5                                         0.9042783 0.9042783
6                                                   0.9042783
```


---
## Parameter estimates 

```r
phiage2.p$results$real
```

```
                 estimate        se       lcl       ucl fixed note
Phi gF c1 a0 t1 0.5508690 0.0343916 0.4829396 0.6169524           
Phi gF c1 a1 t2 0.5715988 0.0380167 0.4960218 0.6439770           
p gF c1 a1 t2   0.9042783 0.0284377 0.8322645 0.9473310           
```



---
class: center, middle
background-size: cover

## Live demo #5: Multisite capture-recapture models

---

## Read in data (1)

Read in csv file:

```r
geese_csv &lt;- read_csv2("dat/allgeese.csv")
```

---
## Read in data (2)


```r
geese_csv
```

```
# A tibble: 623 × 7
   year_1984 year_1985 year_1986 year_1987 year_1988 year_1989     N
       &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt;
 1         0         0         0         0         0         1   158
 2         0         0         0         0         0         2   352
 3         0         0         0         0         0         3   271
 4         0         0         0         0         1         0   317
 5         0         0         0         0         1         1    62
 6         0         0         0         0         1         2    31
 7         0         0         0         0         2         0   748
 8         0         0         0         0         2         1    56
 9         0         0         0         0         2         2   234
10         0         0         0         0         2         3     7
# … with 613 more rows
```

---
## Convert to Mark format (1)

Build a data.frame with encounter histories, and number of individuals:

```r
geese &lt;- data.frame(ch = unite(geese_csv %&gt;% 
                                 select(year_1984:year_1989), 
                               col = "ch", 
                               sep = ""), 
                    freq = geese_csv$N)
```

---
## Convert to Mark format (2)

Inspect first lines:

```r
head(geese)
```

```
      ch freq
1 000001  158
2 000002  352
3 000003  271
4 000010  317
5 000011   62
6 000012   31
```

---
## Preliminaries 


```r
geese.proc &lt;- process.data(data = geese,
                           model = "Multistrata")
```

--


```r
geese.ddl &lt;- make.design.data(geese.proc)
```

--


```r
phi &lt;- list(formula=~1) # survival constant 
phi.site &lt;- list(formula=~stratum) # site-specific survival 
p &lt;- list(formula=~1) # constant detection
psi.site &lt;- list(formula=~-1+stratum:tostratum,
                 link='mlogit') # movements
```

---
## Run model with site effect on survival:


```r
phis.psi.p &lt;- mark(geese.proc,
                   geese.ddl,
                   model.parameters=list(S = phi.site,
                                         p = p,
                                         Psi = psi.site))
```

---


```

Output summary for Multistrata model
Name : S(~stratum)p(~1)Psi(~-1 + stratum:tostratum) 

Npar :  10
-2lnL:  73743.06
AICc :  73763.07

Beta
                          estimate        se        lcl        ucl
S:(Intercept)            0.7203383 0.0312784  0.6590327  0.7816440
S:stratum2               0.0490006 0.0378227 -0.0251320  0.1231331
S:stratum3              -0.1533416 0.0488370 -0.2490622 -0.0576209
p:(Intercept)           -0.3361519 0.0195059 -0.3743835 -0.2979203
Psi:stratum2:tostratum1 -1.9884647 0.0351679 -2.0573938 -1.9195355
Psi:stratum3:tostratum1 -2.5006502 0.1011619 -2.6989275 -2.3023728
Psi:stratum1:tostratum2 -1.1409124 0.0367455 -1.2129336 -1.0688911
Psi:stratum3:tostratum2 -0.8726953 0.0489216 -0.9685815 -0.7768090
Psi:stratum1:tostratum3 -4.9500359 0.2335496 -5.4077932 -4.4922786
Psi:stratum2:tostratum3 -3.6657284 0.0775562 -3.8177385 -3.5137183


Real Parameter S
 Stratum:1 
          1         2         3         4         5
1 0.6726815 0.6726815 0.6726815 0.6726815 0.6726815
2           0.6726815 0.6726815 0.6726815 0.6726815
3                     0.6726815 0.6726815 0.6726815
4                               0.6726815 0.6726815
5                                         0.6726815

 Stratum:2 
          1         2         3         4         5
1 0.6833779 0.6833779 0.6833779 0.6833779 0.6833779
2           0.6833779 0.6833779 0.6833779 0.6833779
3                     0.6833779 0.6833779 0.6833779
4                               0.6833779 0.6833779
5                                         0.6833779

 Stratum:3 
          1         2         3         4         5
1 0.6380699 0.6380699 0.6380699 0.6380699 0.6380699
2           0.6380699 0.6380699 0.6380699 0.6380699
3                     0.6380699 0.6380699 0.6380699
4                               0.6380699 0.6380699
5                                         0.6380699


Real Parameter p
 Stratum:1 
          2         3         4         5         6
1 0.4167445 0.4167445 0.4167445 0.4167445 0.4167445
2           0.4167445 0.4167445 0.4167445 0.4167445
3                     0.4167445 0.4167445 0.4167445
4                               0.4167445 0.4167445
5                                         0.4167445

 Stratum:2 
          2         3         4         5         6
1 0.4167445 0.4167445 0.4167445 0.4167445 0.4167445
2           0.4167445 0.4167445 0.4167445 0.4167445
3                     0.4167445 0.4167445 0.4167445
4                               0.4167445 0.4167445
5                                         0.4167445

 Stratum:3 
          2         3         4         5         6
1 0.4167445 0.4167445 0.4167445 0.4167445 0.4167445
2           0.4167445 0.4167445 0.4167445 0.4167445
3                     0.4167445 0.4167445 0.4167445
4                               0.4167445 0.4167445
5                                         0.4167445


Real Parameter Psi
 Stratum:1 To:2 
        1       2       3       4       5
1 0.24086 0.24086 0.24086 0.24086 0.24086
2         0.24086 0.24086 0.24086 0.24086
3                 0.24086 0.24086 0.24086
4                         0.24086 0.24086
5                                 0.24086

 Stratum:1 To:3 
          1         2         3         4         5
1 0.0053393 0.0053393 0.0053393 0.0053393 0.0053393
2           0.0053393 0.0053393 0.0053393 0.0053393
3                     0.0053393 0.0053393 0.0053393
4                               0.0053393 0.0053393
5                                         0.0053393

 Stratum:2 To:1 
         1        2        3        4        5
1 0.117769 0.117769 0.117769 0.117769 0.117769
2          0.117769 0.117769 0.117769 0.117769
3                   0.117769 0.117769 0.117769
4                            0.117769 0.117769
5                                     0.117769

 Stratum:2 To:3 
          1         2         3         4         5
1 0.0220092 0.0220092 0.0220092 0.0220092 0.0220092
2           0.0220092 0.0220092 0.0220092 0.0220092
3                     0.0220092 0.0220092 0.0220092
4                               0.0220092 0.0220092
5                                         0.0220092

 Stratum:3 To:1 
         1        2        3        4        5
1 0.054693 0.054693 0.054693 0.054693 0.054693
2          0.054693 0.054693 0.054693 0.054693
3                   0.054693 0.054693 0.054693
4                            0.054693 0.054693
5                                     0.054693

 Stratum:3 To:2 
          1         2         3         4         5
1 0.2785761 0.2785761 0.2785761 0.2785761 0.2785761
2           0.2785761 0.2785761 0.2785761 0.2785761
3                     0.2785761 0.2785761 0.2785761
4                               0.2785761 0.2785761
5                                         0.2785761
```



---


```r
phis.psi.p$results$real
```

```
                           estimate        se       lcl       ucl fixed note
S s1 g1 c1 a0 o1 t1       0.6726815 0.0068869 0.6590431 0.6860343           
S s2 g1 c1 a0 o1 t1       0.6833779 0.0050722 0.6733537 0.6932346           
S s3 g1 c1 a0 o1 t1       0.6380699 0.0094721 0.6193065 0.6564216           
p s1 g1 c1 a1 o1 t2       0.4167445 0.0047413 0.4074822 0.4260660           
Psi s1 to2 g1 c1 a0 o1 t1 0.2408600 0.0067228 0.2279303 0.2542816           
Psi s1 to2 g1 c1 a1 o2 t2 0.2408600 0.0067228 0.2279303 0.2542816           
Psi s1 to2 g1 c1 a2 o3 t3 0.2408600 0.0067228 0.2279303 0.2542816           
Psi s1 to2 g1 c1 a3 o4 t4 0.2408600 0.0067228 0.2279303 0.2542816           
Psi s1 to2 g1 c1 a4 o5 t5 0.2408600 0.0067228 0.2279303 0.2542816           
Psi s1 to2 g1 c2 a0 o2 t2 0.2408600 0.0067228 0.2279303 0.2542816           
Psi s1 to2 g1 c2 a1 o3 t3 0.2408600 0.0067228 0.2279303 0.2542816           
Psi s1 to2 g1 c2 a2 o4 t4 0.2408600 0.0067228 0.2279303 0.2542816           
Psi s1 to2 g1 c2 a3 o5 t5 0.2408600 0.0067228 0.2279303 0.2542816           
Psi s1 to2 g1 c3 a0 o3 t3 0.2408600 0.0067228 0.2279303 0.2542816           
Psi s1 to2 g1 c3 a1 o4 t4 0.2408600 0.0067228 0.2279303 0.2542816           
Psi s1 to2 g1 c3 a2 o5 t5 0.2408600 0.0067228 0.2279303 0.2542816           
Psi s1 to2 g1 c4 a0 o4 t4 0.2408600 0.0067228 0.2279303 0.2542816           
Psi s1 to2 g1 c4 a1 o5 t5 0.2408600 0.0067228 0.2279303 0.2542816           
Psi s1 to2 g1 c5 a0 o5 t5 0.2408600 0.0067228 0.2279303 0.2542816           
Psi s1 to3 g1 c1 a0 o1 t1 0.0053393 0.0012408 0.0033842 0.0084143           
Psi s1 to3 g1 c1 a1 o2 t2 0.0053393 0.0012408 0.0033842 0.0084143           
Psi s1 to3 g1 c1 a2 o3 t3 0.0053393 0.0012408 0.0033842 0.0084143           
Psi s1 to3 g1 c1 a3 o4 t4 0.0053393 0.0012408 0.0033842 0.0084143           
Psi s1 to3 g1 c1 a4 o5 t5 0.0053393 0.0012408 0.0033842 0.0084143           
Psi s1 to3 g1 c2 a0 o2 t2 0.0053393 0.0012408 0.0033842 0.0084143           
Psi s1 to3 g1 c2 a1 o3 t3 0.0053393 0.0012408 0.0033842 0.0084143           
Psi s1 to3 g1 c2 a2 o4 t4 0.0053393 0.0012408 0.0033842 0.0084143           
Psi s1 to3 g1 c2 a3 o5 t5 0.0053393 0.0012408 0.0033842 0.0084143           
Psi s1 to3 g1 c3 a0 o3 t3 0.0053393 0.0012408 0.0033842 0.0084143           
Psi s1 to3 g1 c3 a1 o4 t4 0.0053393 0.0012408 0.0033842 0.0084143           
Psi s1 to3 g1 c3 a2 o5 t5 0.0053393 0.0012408 0.0033842 0.0084143           
Psi s1 to3 g1 c4 a0 o4 t4 0.0053393 0.0012408 0.0033842 0.0084143           
Psi s1 to3 g1 c4 a1 o5 t5 0.0053393 0.0012408 0.0033842 0.0084143           
Psi s1 to3 g1 c5 a0 o5 t5 0.0053393 0.0012408 0.0033842 0.0084143           
Psi s2 to1 g1 c1 a0 o1 t1 0.1177690 0.0036470 0.1108067 0.1251073           
Psi s2 to1 g1 c1 a1 o2 t2 0.1177690 0.0036470 0.1108067 0.1251073           
Psi s2 to1 g1 c1 a2 o3 t3 0.1177690 0.0036470 0.1108067 0.1251073           
Psi s2 to1 g1 c1 a3 o4 t4 0.1177690 0.0036470 0.1108067 0.1251073           
Psi s2 to1 g1 c1 a4 o5 t5 0.1177690 0.0036470 0.1108067 0.1251073           
Psi s2 to1 g1 c2 a0 o2 t2 0.1177690 0.0036470 0.1108067 0.1251073           
Psi s2 to1 g1 c2 a1 o3 t3 0.1177690 0.0036470 0.1108067 0.1251073           
Psi s2 to1 g1 c2 a2 o4 t4 0.1177690 0.0036470 0.1108067 0.1251073           
Psi s2 to1 g1 c2 a3 o5 t5 0.1177690 0.0036470 0.1108067 0.1251073           
Psi s2 to1 g1 c3 a0 o3 t3 0.1177690 0.0036470 0.1108067 0.1251073           
Psi s2 to1 g1 c3 a1 o4 t4 0.1177690 0.0036470 0.1108067 0.1251073           
Psi s2 to1 g1 c3 a2 o5 t5 0.1177690 0.0036470 0.1108067 0.1251073           
Psi s2 to1 g1 c4 a0 o4 t4 0.1177690 0.0036470 0.1108067 0.1251073           
Psi s2 to1 g1 c4 a1 o5 t5 0.1177690 0.0036470 0.1108067 0.1251073           
Psi s2 to1 g1 c5 a0 o5 t5 0.1177690 0.0036470 0.1108067 0.1251073           
Psi s2 to3 g1 c1 a0 o1 t1 0.0220092 0.0016662 0.0189697 0.0255231           
Psi s2 to3 g1 c1 a1 o2 t2 0.0220092 0.0016662 0.0189697 0.0255231           
Psi s2 to3 g1 c1 a2 o3 t3 0.0220092 0.0016662 0.0189697 0.0255231           
Psi s2 to3 g1 c1 a3 o4 t4 0.0220092 0.0016662 0.0189697 0.0255231           
Psi s2 to3 g1 c1 a4 o5 t5 0.0220092 0.0016662 0.0189697 0.0255231           
Psi s2 to3 g1 c2 a0 o2 t2 0.0220092 0.0016662 0.0189697 0.0255231           
Psi s2 to3 g1 c2 a1 o3 t3 0.0220092 0.0016662 0.0189697 0.0255231           
Psi s2 to3 g1 c2 a2 o4 t4 0.0220092 0.0016662 0.0189697 0.0255231           
Psi s2 to3 g1 c2 a3 o5 t5 0.0220092 0.0016662 0.0189697 0.0255231           
Psi s2 to3 g1 c3 a0 o3 t3 0.0220092 0.0016662 0.0189697 0.0255231           
Psi s2 to3 g1 c3 a1 o4 t4 0.0220092 0.0016662 0.0189697 0.0255231           
Psi s2 to3 g1 c3 a2 o5 t5 0.0220092 0.0016662 0.0189697 0.0255231           
Psi s2 to3 g1 c4 a0 o4 t4 0.0220092 0.0016662 0.0189697 0.0255231           
Psi s2 to3 g1 c4 a1 o5 t5 0.0220092 0.0016662 0.0189697 0.0255231           
Psi s2 to3 g1 c5 a0 o5 t5 0.0220092 0.0016662 0.0189697 0.0255231           
Psi s3 to1 g1 c1 a0 o1 t1 0.0546930 0.0052218 0.0453156 0.0658772           
Psi s3 to1 g1 c1 a1 o2 t2 0.0546930 0.0052218 0.0453156 0.0658772           
Psi s3 to1 g1 c1 a2 o3 t3 0.0546930 0.0052218 0.0453156 0.0658772           
Psi s3 to1 g1 c1 a3 o4 t4 0.0546930 0.0052218 0.0453156 0.0658772           
Psi s3 to1 g1 c1 a4 o5 t5 0.0546930 0.0052218 0.0453156 0.0658772           
Psi s3 to1 g1 c2 a0 o2 t2 0.0546930 0.0052218 0.0453156 0.0658772           
Psi s3 to1 g1 c2 a1 o3 t3 0.0546930 0.0052218 0.0453156 0.0658772           
Psi s3 to1 g1 c2 a2 o4 t4 0.0546930 0.0052218 0.0453156 0.0658772           
Psi s3 to1 g1 c2 a3 o5 t5 0.0546930 0.0052218 0.0453156 0.0658772           
Psi s3 to1 g1 c3 a0 o3 t3 0.0546930 0.0052218 0.0453156 0.0658772           
Psi s3 to1 g1 c3 a1 o4 t4 0.0546930 0.0052218 0.0453156 0.0658772           
Psi s3 to1 g1 c3 a2 o5 t5 0.0546930 0.0052218 0.0453156 0.0658772           
Psi s3 to1 g1 c4 a0 o4 t4 0.0546930 0.0052218 0.0453156 0.0658772           
Psi s3 to1 g1 c4 a1 o5 t5 0.0546930 0.0052218 0.0453156 0.0658772           
Psi s3 to1 g1 c5 a0 o5 t5 0.0546930 0.0052218 0.0453156 0.0658772           
Psi s3 to2 g1 c1 a0 o1 t1 0.2785761 0.0098254 0.2597326 0.2982359           
Psi s3 to2 g1 c1 a1 o2 t2 0.2785761 0.0098254 0.2597326 0.2982359           
Psi s3 to2 g1 c1 a2 o3 t3 0.2785761 0.0098254 0.2597326 0.2982359           
Psi s3 to2 g1 c1 a3 o4 t4 0.2785761 0.0098254 0.2597326 0.2982359           
Psi s3 to2 g1 c1 a4 o5 t5 0.2785761 0.0098254 0.2597326 0.2982359           
Psi s3 to2 g1 c2 a0 o2 t2 0.2785761 0.0098254 0.2597326 0.2982359           
Psi s3 to2 g1 c2 a1 o3 t3 0.2785761 0.0098254 0.2597326 0.2982359           
Psi s3 to2 g1 c2 a2 o4 t4 0.2785761 0.0098254 0.2597326 0.2982359           
Psi s3 to2 g1 c2 a3 o5 t5 0.2785761 0.0098254 0.2597326 0.2982359           
Psi s3 to2 g1 c3 a0 o3 t3 0.2785761 0.0098254 0.2597326 0.2982359           
Psi s3 to2 g1 c3 a1 o4 t4 0.2785761 0.0098254 0.2597326 0.2982359           
Psi s3 to2 g1 c3 a2 o5 t5 0.2785761 0.0098254 0.2597326 0.2982359           
Psi s3 to2 g1 c4 a0 o4 t4 0.2785761 0.0098254 0.2597326 0.2982359           
Psi s3 to2 g1 c4 a1 o5 t5 0.2785761 0.0098254 0.2597326 0.2982359           
Psi s3 to2 g1 c5 a0 o5 t5 0.2785761 0.0098254 0.2597326 0.2982359           
```

---


```r
Psilist &lt;- get.real(phis.psi.p, "Psi", vcv = TRUE)
Psi.values = Psilist$estimates
top.psi = TransitionMatrix(Psi.values[Psi.values$time == 1, ], 
                           vcv.real = Psilist$vcv.real)
top.psi
```

```
$TransitionMat
           1         2           3
1 0.75380075 0.2408600 0.005339287
2 0.11776905 0.8602217 0.022009227
3 0.05469303 0.2785761 0.666730889

$se.TransitionMat
            1           2           3
1 0.006745691 0.006722837 0.001240811
2 0.003647025 0.003936542 0.001666232
3 0.005221795 0.009825364 0.010085037

$lcl.TransitionMat
           1         2           3
1 0.74034153 0.2279303 0.003384212
2 0.11080671 0.8523263 0.018969675
3 0.04531556 0.2597326 0.646680041

$ucl.TransitionMat
           1         2           3
1 0.76678210 0.2542816 0.008414282
2 0.12510730 0.8677605 0.025523141
3 0.06587715 0.2982359 0.686196017
```

---
## Run model with state effect on survival 


```r
phi.psi.p &lt;- mark(geese.proc,
                  geese.ddl,
                  model.parameters=list(S = phi,
                                        p = p,
                                        Psi = psi.site))
```

---


```

Output summary for Multistrata model
Name : S(~1)p(~1)Psi(~-1 + stratum:tostratum) 

Npar :  8
-2lnL:  73762.35
AICc :  73778.35

Beta
                          estimate        se        lcl        ucl
S:(Intercept)            0.7285802 0.0183463  0.6926215  0.7645389
p:(Intercept)           -0.3409441 0.0194757 -0.3791165 -0.3027716
Psi:stratum2:tostratum1 -1.9911509 0.0351079 -2.0599624 -1.9223393
Psi:stratum3:tostratum1 -2.4855117 0.1007717 -2.6830242 -2.2879993
Psi:stratum1:tostratum2 -1.1367646 0.0365654 -1.2084328 -1.0650964
Psi:stratum3:tostratum2 -0.8560144 0.0486932 -0.9514531 -0.7605758
Psi:stratum1:tostratum3 -4.9580438 0.2326098 -5.4139590 -4.5021286
Psi:stratum2:tostratum3 -3.6807672 0.0775501 -3.8327654 -3.5287689


Real Parameter S
 Stratum:1 
          1         2         3         4         5
1 0.6744936 0.6744936 0.6744936 0.6744936 0.6744936
2           0.6744936 0.6744936 0.6744936 0.6744936
3                     0.6744936 0.6744936 0.6744936
4                               0.6744936 0.6744936
5                                         0.6744936

 Stratum:2 
          1         2         3         4         5
1 0.6744936 0.6744936 0.6744936 0.6744936 0.6744936
2           0.6744936 0.6744936 0.6744936 0.6744936
3                     0.6744936 0.6744936 0.6744936
4                               0.6744936 0.6744936
5                                         0.6744936

 Stratum:3 
          1         2         3         4         5
1 0.6744936 0.6744936 0.6744936 0.6744936 0.6744936
2           0.6744936 0.6744936 0.6744936 0.6744936
3                     0.6744936 0.6744936 0.6744936
4                               0.6744936 0.6744936
5                                         0.6744936


Real Parameter p
 Stratum:1 
          2         3         4         5         6
1 0.4155802 0.4155802 0.4155802 0.4155802 0.4155802
2           0.4155802 0.4155802 0.4155802 0.4155802
3                     0.4155802 0.4155802 0.4155802
4                               0.4155802 0.4155802
5                                         0.4155802

 Stratum:2 
          2         3         4         5         6
1 0.4155802 0.4155802 0.4155802 0.4155802 0.4155802
2           0.4155802 0.4155802 0.4155802 0.4155802
3                     0.4155802 0.4155802 0.4155802
4                               0.4155802 0.4155802
5                                         0.4155802

 Stratum:3 
          2         3         4         5         6
1 0.4155802 0.4155802 0.4155802 0.4155802 0.4155802
2           0.4155802 0.4155802 0.4155802 0.4155802
3                     0.4155802 0.4155802 0.4155802
4                               0.4155802 0.4155802
5                                         0.4155802


Real Parameter Psi
 Stratum:1 To:2 
          1         2         3         4         5
1 0.2416295 0.2416295 0.2416295 0.2416295 0.2416295
2           0.2416295 0.2416295 0.2416295 0.2416295
3                     0.2416295 0.2416295 0.2416295
4                               0.2416295 0.2416295
5                                         0.2416295

 Stratum:1 To:3 
          1         2         3         4         5
1 0.0052916 0.0052916 0.0052916 0.0052916 0.0052916
2           0.0052916 0.0052916 0.0052916 0.0052916
3                     0.0052916 0.0052916 0.0052916
4                               0.0052916 0.0052916
5                                         0.0052916

 Stratum:2 To:1 
          1         2         3         4         5
1 0.1175289 0.1175289 0.1175289 0.1175289 0.1175289
2           0.1175289 0.1175289 0.1175289 0.1175289
3                     0.1175289 0.1175289 0.1175289
4                               0.1175289 0.1175289
5                                         0.1175289

 Stratum:2 To:3 
          1         2         3         4         5
1 0.0216947 0.0216947 0.0216947 0.0216947 0.0216947
2           0.0216947 0.0216947 0.0216947 0.0216947
3                     0.0216947 0.0216947 0.0216947
4                               0.0216947 0.0216947
5                                         0.0216947

 Stratum:3 To:1 
          1         2         3         4         5
1 0.0552225 0.0552225 0.0552225 0.0552225 0.0552225
2           0.0552225 0.0552225 0.0552225 0.0552225
3                     0.0552225 0.0552225 0.0552225
4                               0.0552225 0.0552225
5                                         0.0552225

 Stratum:3 To:2 
          1         2         3         4         5
1 0.2817069 0.2817069 0.2817069 0.2817069 0.2817069
2           0.2817069 0.2817069 0.2817069 0.2817069
3                     0.2817069 0.2817069 0.2817069
4                               0.2817069 0.2817069
5                                         0.2817069
```

---


```r
phi.psi.p$results$real
```

```
                           estimate        se       lcl       ucl fixed note
S s1 g1 c1 a0 o1 t1       0.6744936 0.0040280 0.6665498 0.6823384           
p s1 g1 c1 a1 o1 t2       0.4155802 0.0047301 0.4063400 0.4248801           
Psi s1 to2 g1 c1 a0 o1 t1 0.2416295 0.0067049 0.2287325 0.2550132           
Psi s1 to2 g1 c1 a1 o2 t2 0.2416295 0.0067049 0.2287325 0.2550132           
Psi s1 to2 g1 c1 a2 o3 t3 0.2416295 0.0067049 0.2287325 0.2550132           
Psi s1 to2 g1 c1 a3 o4 t4 0.2416295 0.0067049 0.2287325 0.2550132           
Psi s1 to2 g1 c1 a4 o5 t5 0.2416295 0.0067049 0.2287325 0.2550132           
Psi s1 to2 g1 c2 a0 o2 t2 0.2416295 0.0067049 0.2287325 0.2550132           
Psi s1 to2 g1 c2 a1 o3 t3 0.2416295 0.0067049 0.2287325 0.2550132           
Psi s1 to2 g1 c2 a2 o4 t4 0.2416295 0.0067049 0.2287325 0.2550132           
Psi s1 to2 g1 c2 a3 o5 t5 0.2416295 0.0067049 0.2287325 0.2550132           
Psi s1 to2 g1 c3 a0 o3 t3 0.2416295 0.0067049 0.2287325 0.2550132           
Psi s1 to2 g1 c3 a1 o4 t4 0.2416295 0.0067049 0.2287325 0.2550132           
Psi s1 to2 g1 c3 a2 o5 t5 0.2416295 0.0067049 0.2287325 0.2550132           
Psi s1 to2 g1 c4 a0 o4 t4 0.2416295 0.0067049 0.2287325 0.2550132           
Psi s1 to2 g1 c4 a1 o5 t5 0.2416295 0.0067049 0.2287325 0.2550132           
Psi s1 to2 g1 c5 a0 o5 t5 0.2416295 0.0067049 0.2287325 0.2550132           
Psi s1 to3 g1 c1 a0 o1 t1 0.0052916 0.0012249 0.0033600 0.0083244           
Psi s1 to3 g1 c1 a1 o2 t2 0.0052916 0.0012249 0.0033600 0.0083244           
Psi s1 to3 g1 c1 a2 o3 t3 0.0052916 0.0012249 0.0033600 0.0083244           
Psi s1 to3 g1 c1 a3 o4 t4 0.0052916 0.0012249 0.0033600 0.0083244           
Psi s1 to3 g1 c1 a4 o5 t5 0.0052916 0.0012249 0.0033600 0.0083244           
Psi s1 to3 g1 c2 a0 o2 t2 0.0052916 0.0012249 0.0033600 0.0083244           
Psi s1 to3 g1 c2 a1 o3 t3 0.0052916 0.0012249 0.0033600 0.0083244           
Psi s1 to3 g1 c2 a2 o4 t4 0.0052916 0.0012249 0.0033600 0.0083244           
Psi s1 to3 g1 c2 a3 o5 t5 0.0052916 0.0012249 0.0033600 0.0083244           
Psi s1 to3 g1 c3 a0 o3 t3 0.0052916 0.0012249 0.0033600 0.0083244           
Psi s1 to3 g1 c3 a1 o4 t4 0.0052916 0.0012249 0.0033600 0.0083244           
Psi s1 to3 g1 c3 a2 o5 t5 0.0052916 0.0012249 0.0033600 0.0083244           
Psi s1 to3 g1 c4 a0 o4 t4 0.0052916 0.0012249 0.0033600 0.0083244           
Psi s1 to3 g1 c4 a1 o5 t5 0.0052916 0.0012249 0.0033600 0.0083244           
Psi s1 to3 g1 c5 a0 o5 t5 0.0052916 0.0012249 0.0033600 0.0083244           
Psi s2 to1 g1 c1 a0 o1 t1 0.1175289 0.0036343 0.1105906 0.1248413           
Psi s2 to1 g1 c1 a1 o2 t2 0.1175289 0.0036343 0.1105906 0.1248413           
Psi s2 to1 g1 c1 a2 o3 t3 0.1175289 0.0036343 0.1105906 0.1248413           
Psi s2 to1 g1 c1 a3 o4 t4 0.1175289 0.0036343 0.1105906 0.1248413           
Psi s2 to1 g1 c1 a4 o5 t5 0.1175289 0.0036343 0.1105906 0.1248413           
Psi s2 to1 g1 c2 a0 o2 t2 0.1175289 0.0036343 0.1105906 0.1248413           
Psi s2 to1 g1 c2 a1 o3 t3 0.1175289 0.0036343 0.1105906 0.1248413           
Psi s2 to1 g1 c2 a2 o4 t4 0.1175289 0.0036343 0.1105906 0.1248413           
Psi s2 to1 g1 c2 a3 o5 t5 0.1175289 0.0036343 0.1105906 0.1248413           
Psi s2 to1 g1 c3 a0 o3 t3 0.1175289 0.0036343 0.1105906 0.1248413           
Psi s2 to1 g1 c3 a1 o4 t4 0.1175289 0.0036343 0.1105906 0.1248413           
Psi s2 to1 g1 c3 a2 o5 t5 0.1175289 0.0036343 0.1105906 0.1248413           
Psi s2 to1 g1 c4 a0 o4 t4 0.1175289 0.0036343 0.1105906 0.1248413           
Psi s2 to1 g1 c4 a1 o5 t5 0.1175289 0.0036343 0.1105906 0.1248413           
Psi s2 to1 g1 c5 a0 o5 t5 0.1175289 0.0036343 0.1105906 0.1248413           
Psi s2 to3 g1 c1 a0 o1 t1 0.0216947 0.0016428 0.0186980 0.0251593           
Psi s2 to3 g1 c1 a1 o2 t2 0.0216947 0.0016428 0.0186980 0.0251593           
Psi s2 to3 g1 c1 a2 o3 t3 0.0216947 0.0016428 0.0186980 0.0251593           
Psi s2 to3 g1 c1 a3 o4 t4 0.0216947 0.0016428 0.0186980 0.0251593           
Psi s2 to3 g1 c1 a4 o5 t5 0.0216947 0.0016428 0.0186980 0.0251593           
Psi s2 to3 g1 c2 a0 o2 t2 0.0216947 0.0016428 0.0186980 0.0251593           
Psi s2 to3 g1 c2 a1 o3 t3 0.0216947 0.0016428 0.0186980 0.0251593           
Psi s2 to3 g1 c2 a2 o4 t4 0.0216947 0.0016428 0.0186980 0.0251593           
Psi s2 to3 g1 c2 a3 o5 t5 0.0216947 0.0016428 0.0186980 0.0251593           
Psi s2 to3 g1 c3 a0 o3 t3 0.0216947 0.0016428 0.0186980 0.0251593           
Psi s2 to3 g1 c3 a1 o4 t4 0.0216947 0.0016428 0.0186980 0.0251593           
Psi s2 to3 g1 c3 a2 o5 t5 0.0216947 0.0016428 0.0186980 0.0251593           
Psi s2 to3 g1 c4 a0 o4 t4 0.0216947 0.0016428 0.0186980 0.0251593           
Psi s2 to3 g1 c4 a1 o5 t5 0.0216947 0.0016428 0.0186980 0.0251593           
Psi s2 to3 g1 c5 a0 o5 t5 0.0216947 0.0016428 0.0186980 0.0251593           
Psi s3 to1 g1 c1 a0 o1 t1 0.0552225 0.0052513 0.0457883 0.0664650           
Psi s3 to1 g1 c1 a1 o2 t2 0.0552225 0.0052513 0.0457883 0.0664650           
Psi s3 to1 g1 c1 a2 o3 t3 0.0552225 0.0052513 0.0457883 0.0664650           
Psi s3 to1 g1 c1 a3 o4 t4 0.0552225 0.0052513 0.0457883 0.0664650           
Psi s3 to1 g1 c1 a4 o5 t5 0.0552225 0.0052513 0.0457883 0.0664650           
Psi s3 to1 g1 c2 a0 o2 t2 0.0552225 0.0052513 0.0457883 0.0664650           
Psi s3 to1 g1 c2 a1 o3 t3 0.0552225 0.0052513 0.0457883 0.0664650           
Psi s3 to1 g1 c2 a2 o4 t4 0.0552225 0.0052513 0.0457883 0.0664650           
Psi s3 to1 g1 c2 a3 o5 t5 0.0552225 0.0052513 0.0457883 0.0664650           
Psi s3 to1 g1 c3 a0 o3 t3 0.0552225 0.0052513 0.0457883 0.0664650           
Psi s3 to1 g1 c3 a1 o4 t4 0.0552225 0.0052513 0.0457883 0.0664650           
Psi s3 to1 g1 c3 a2 o5 t5 0.0552225 0.0052513 0.0457883 0.0664650           
Psi s3 to1 g1 c4 a0 o4 t4 0.0552225 0.0052513 0.0457883 0.0664650           
Psi s3 to1 g1 c4 a1 o5 t5 0.0552225 0.0052513 0.0457883 0.0664650           
Psi s3 to1 g1 c5 a0 o5 t5 0.0552225 0.0052513 0.0457883 0.0664650           
Psi s3 to2 g1 c1 a0 o1 t1 0.2817069 0.0098518 0.2628054 0.3014119           
Psi s3 to2 g1 c1 a1 o2 t2 0.2817069 0.0098518 0.2628054 0.3014119           
Psi s3 to2 g1 c1 a2 o3 t3 0.2817069 0.0098518 0.2628054 0.3014119           
Psi s3 to2 g1 c1 a3 o4 t4 0.2817069 0.0098518 0.2628054 0.3014119           
Psi s3 to2 g1 c1 a4 o5 t5 0.2817069 0.0098518 0.2628054 0.3014119           
Psi s3 to2 g1 c2 a0 o2 t2 0.2817069 0.0098518 0.2628054 0.3014119           
Psi s3 to2 g1 c2 a1 o3 t3 0.2817069 0.0098518 0.2628054 0.3014119           
Psi s3 to2 g1 c2 a2 o4 t4 0.2817069 0.0098518 0.2628054 0.3014119           
Psi s3 to2 g1 c2 a3 o5 t5 0.2817069 0.0098518 0.2628054 0.3014119           
Psi s3 to2 g1 c3 a0 o3 t3 0.2817069 0.0098518 0.2628054 0.3014119           
Psi s3 to2 g1 c3 a1 o4 t4 0.2817069 0.0098518 0.2628054 0.3014119           
Psi s3 to2 g1 c3 a2 o5 t5 0.2817069 0.0098518 0.2628054 0.3014119           
Psi s3 to2 g1 c4 a0 o4 t4 0.2817069 0.0098518 0.2628054 0.3014119           
Psi s3 to2 g1 c4 a1 o5 t5 0.2817069 0.0098518 0.2628054 0.3014119           
Psi s3 to2 g1 c5 a0 o5 t5 0.2817069 0.0098518 0.2628054 0.3014119           
```


---


```r
Psilist &lt;- get.real(phi.psi.p, "Psi", vcv = TRUE)
Psi.values = Psilist$estimates
top.psi = TransitionMatrix(Psi.values[Psi.values$time == 1, ], 
                           vcv.real = Psilist$vcv.real)
top.psi
```

```
$TransitionMat
           1         2           3
1 0.75307891 0.2416295 0.005291629
2 0.11752886 0.8607764 0.021694692
3 0.05522246 0.2817069 0.663070644

$se.TransitionMat
            1           2           3
1 0.006724585 0.006704854 0.001224924
2 0.003634296 0.003918256 0.001642782
3 0.005251289 0.009851796 0.010086296

$lcl.TransitionMat
           1         2           3
1 0.73966369 0.2287324 0.003360014
2 0.11059062 0.8529177 0.018698030
3 0.04578831 0.2628055 0.643025330

$ucl.TransitionMat
           1         2           3
1 0.76602151 0.2550132 0.008324423
2 0.12484129 0.8682802 0.025159305
3 0.06646502 0.3014119 0.682546048
```


---


```r
collect.models()
```

```
                                         model npar     AICc DeltaAICc
2 S(~stratum)p(~1)Psi(~-1 + stratum:tostratum)   10 73763.07   0.00000
1       S(~1)p(~1)Psi(~-1 + stratum:tostratum)    8 73778.36  15.29048
        weight Deviance
2 0.9995219131 2587.346
1 0.0004780869 2606.639
```




    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"ratio": "16:9",
"highlightStyle": "github",
"highlightLines": true,
"slideNumberFormat": ""
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
