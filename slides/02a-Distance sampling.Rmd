---
title: "Distance sampling"
author: "Aurélien Besnard"
date: "last updated: `r Sys.Date()`"
output:
  xaringan::moon_reader:
    css: [default, "slides-theme.css"]
    lib_dir: libs
    nature:
      ratio: '16:9' 
      highlightStyle: github
      highlightLines: true
      slideNumberFormat: ''
      titleSlideClass: [center, middle]
---
```{r setup, include=FALSE, echo=FALSE, cache = FALSE}
options(htmltools.dir.version = FALSE)
knitr::opts_chunk$set(comment = "")
library(tidyverse)
theme_set(theme_light())
update_geom_defaults("point", list(size = 2)) 
```

# Count individuals along strip transects

Traditionnal methods = count animals (or plants) along transects of fixed width
```{r, echo=FALSE, out.width="80%", fig.align='center'}
knitr::include_graphics("Diapositive12.JPG")
```

---
# Count individuals along strip transects

Assume all individuals in the strip are detected and counted
```{r, echo=FALSE, out.width="80%", fig.align='center'}
knitr::include_graphics("Diapositive13.JPG")
```

---
# Count individuals inside a circular area

The survey area can also be a circle = circular plot

```{r, echo=FALSE, out.width="80%", fig.align='center'}
knitr::include_graphics("Diapositive14.JPG")
```

---
# Count individuals inside a circular area

Assume all individuals in the circle are detected and counted

```{r, echo=FALSE, out.width="80%", fig.align='center'}
knitr::include_graphics("Diapositive15.JPG")
```

---
## Estimating density and abundance using counts (1)

Using raw counts  in the sample strips/circles

Density is easily estimated using : 

$$\hat{D}=\frac{\sum_{i=1}^ny_i}{\sum_{i=1}^n{a_i}}$$

With $y_i$ the count at each sample unit, and $a_i$ the surface of each sample unit

That can be translate into abundance N with : 
$$\hat{N} = \frac{\sum_{i=1}^ny_i}{\alpha}$$
with $\alpha$ the proportion of the study area eventually sampled


---
## Estimating density and abundance using counts (2)

```{r, echo=FALSE, out.width="50%", fig.align='center'}
knitr::include_graphics("Diapositive13.JPG")
```

L= transect length, w=transect width, y = number of birds detected

$$\hat{D}=\frac{\sum_{i=1}^ny_i}{\sum_{i=1}^nL_i*w_i}$$

---
## Estimating density and abundance using counts (3)

```{r, echo=FALSE, out.width="50%", fig.align='center'}
knitr::include_graphics("Diapositive15.JPG")
```

w =radius, y = number of birds detected

$$\hat{D}=\frac{\sum_{i=1}^ny_i}{\sum_{i=1}^n\pi*w_i^2}$$

---
# Assumptions

All individuals in the sample area are detected and counted

Yet detection probability is (always) below 1 (see first course this morning)

It can varies between the sample units and even in the sample units (depending on vegetation cover for instance)

*Note also that some observations are wasted (those outside the strips/circles)*


---
# Distance sampling - background (1)

The number of detection tends to decrease with the distance to the observer...

...some information on detection probability is encapsulated in the distances

What if we record the distances of detected individuals rather than only their presence ?

---
# Distance sampling - background (2)

Observations along a transect

Record perpendicular distances to the transects, assume not all individuals are detected
```{r, echo=FALSE, out.width="80%", fig.align='center'}
knitr::include_graphics("Diapositive16.JPG")
```

---
# Distance sampling - background (3)

Observations along several transects

```{r, echo=FALSE, out.width="80%", fig.align='center'}
knitr::include_graphics("Diapositive17.JPG")
```

---
# Distance sampling - background (4)

Observations from a fix locations

Record radial distances to the point, assume not all individuals are detected

```{r, echo=FALSE, out.width="80%", fig.align='center'}
knitr::include_graphics("Diapositive18.JPG")
```

---
# Distance sampling - background (5)

Observations from several fix locations

```{r, echo=FALSE, out.width="80%", fig.align='center'}
knitr::include_graphics("Diapositive19.JPG")
```

---
# Estimating density when detection<1


$$\hat{D}=\frac{\sum_{i=1}^ny_i}{a*\hat{p}}$$

With *p* the mean detection probability on the entire sampled area of surface *a*

*Note the match with Capture-recapture methods $\hat{N}=\frac{C}{\hat{p}}$*

How to estimate *p* using distance data ?

---
# Recorded data 

Distance sampling recorded data typically look like :

```{r, echo=FALSE, out.width="60%", fig.align='center'}
knitr::include_graphics("Diapositive22.JPG")
```
If *p* was equal to one, the histrogram would be flat

The decrease results from a decreasing detection probability with distance to the observer

---
# Estimating detection with distance data (1)

Some individuals are detected, some are not

```{r, echo=FALSE, out.width="80%", fig.align='center'}
knitr::include_graphics("Diapositive21.JPG")
```

---
# Estimating detection with distance data (2)

For instance, if 100 individuals are observed and that 70% of the individuals are detected (below the curve) and 30% not detected

$$\hat{D} = \frac{100}{0.70} = 143$$

```{r, echo=FALSE, out.width="60%", fig.align='center'}
knitr::include_graphics("Diapositive21.JPG")
```

---
# How to extract *p* from these data ?

We need to estimate *p*

To do that, We need to fit a detection curve on the raw data

```{r, echo=FALSE, out.width="80%", fig.align='center'}
knitr::include_graphics("Diapositive20.JPG")
```
---
# How to extract P from these data ?

.pull-left[
```{r, echo=FALSE, out.width="90%", fig.align='center'}
knitr::include_graphics("Diapositive21.JPG")
```
]

.pull-right[

$\hat{p}=\frac{\int_{0}^{w} \hat{g}(x)\,dx}{w}$

with w the distance at which data are truncated and $g(x)$ the detection curve 

it is the $\frac{area\,under\, the\, curve }{area\, of\, the\, rectangle}$ 
]

---
# Modelling the detection function (1)

$g(x)$, the detection probability given the distance, need to be estimated

$g(x)$ is not known and may vary a lot due to factors such as observer experience and environment

The strategy of Distance sampling is to go for a few models for g(x) that have good properties:

- model robustness
- shape criterion
- efficiency


---
# Modelling the detection function (2)
Model robustness

- General function that can take a variety of shapes

- Robust w.r.t. pooling


Shape criterion 

- A “shoulder” near the transect line (detection approx. 1 around the line / point)


Efficiency 

- Provides precise estimates – use Maximum Likelihood

---
# Modelling the detection function (3)

Two component for $g(x)$ :

- A ‘key’ function (uniform, half-normal, hazard-rate)

- A ‘series’ expansion (cosine, simple polynomial, hermite polynomial)


---
# Fit a detection curve on the raw dat

```{r, echo=FALSE, out.width="80%", fig.align='center'}
knitr::include_graphics("Diapositive22.JPG")
```


---
# Uniform *key*

```{r, echo=FALSE, out.width="80%", fig.align='center'}
knitr::include_graphics("Diapositive23.JPG")
```

---
# Half-normal *key*


```{r, echo=FALSE, out.width="80%", fig.align='center'}
knitr::include_graphics("Diapositive24.JPG")
```


---
# Half-normal *key*

Change $\sigma$ allow to change the length of the tail

```{r, echo=FALSE, out.width="80%", fig.align='center'}
knitr::include_graphics("Diapositive25.JPG")
```

---
# Hazard-rate *key*

```{r, echo=FALSE, out.width="80%", fig.align='center'}
knitr::include_graphics("Diapositive26.JPG")
```

---
# Hazard-rate *key*

Change *b* allow to change the shoudler and the tail

```{r, echo=FALSE, out.width="80%", fig.align='center'}
knitr::include_graphics("Diapositive27.JPG")
```
---
# Series expansion

- cosine $\sum a_j \cos (\frac{j \pi y}{w})$ 

- simple polynomial $\sum a_j (\frac{y}{w})^2j$

- hermite polynomial $\sum a_j H_2j (\frac{y}{\sigma})$
---
# Series expansion

Uniforme key function + single cosine adjustment term

```{r, echo=FALSE, out.width="80%", fig.align='center'}
knitr::include_graphics("Diapositive28.JPG")
```

---
# Three critical assumptions

- Individuals on the line or point are all detected g(0)=1

- Individuals are detected at their initial location

- Measures are recorded accurately

---
# Individuals on the line or point are all detected

If g(0) is below 1 and unknown, density is underestimated of an unknown factor

```{r, echo=FALSE, out.width="80%", fig.align='center'}
knitr::include_graphics("Diapositive29.JPG")
```

---
# Individuals on the line or point are all detected

Possible to estimate g(0) using two or more independent observers or radiotrack individuals

Ensure g(0)=1 using cameras, trained pointing dogs, but be aware of potential biais

Use more recent modelling approach, i.e. Distance sampling with temporary emigration (need repeated surveys on the same sample unit)


---
# Individuals are detected at their initial location

Assumption 2: Animals do not move before detection (snapshot)

Effect of violation: 
- Random movements induce positive bias. Provided object movement is slow relative to movement of the observer, the bias is small. 
- Responsive movements can cause large bias (positive if there is attraction to the observer, negative if there is avoidance).

Recommendations: 
- In point transects, wait once on site before proceeding
- In line transects, look well ahead


---
# Measures are recorded accurately

Assumption 3: Distances are measured accurately.

Effect of violation: 
- The estimator is fairly robust to random errors in measurement. 
- It is sensitive to extreme outliers and to rounding distances.

Recommendations:
- If exact measurements are difficult, use intervals (group data)
- If outliers, use truncation (5-10% of the largest observations)
- If heaping (convenient ‘rounding’), use intervals and choose cutpoints such that “heaps” are at the midpoint of an interval
- Accurate measurement is the most effective solution, so use appropriate tools (tape measures; laser range finders; compass for angles)

---
# Line or point transects ?

Point transects is :
- Relevant for populations distributed in patches
- Convenient to use when the area is difficult to access / survey
- Naturally suited for stratification

Line transects is :
- Efficient for sparsely distributed populations
- Effective in low densities

---
# and now Live Demo in R



